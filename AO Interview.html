<!DOCTYPE html> <html lang=en class=light style=color-scheme:light><!--
// Form submission handler for AO Interview registration
(function() {
  'use strict';
  
  console.log('=== FORM HANDLER SCRIPT LOADED ===');
  
  // ============================================
  // DROPDOWN MENU - NEW CLEAN IMPLEMENTATION
  // ============================================
  
  const leaders = [
    'Aaron Benjamin',
    'Abigail Johnson',
    'Adrian Martinez',
    'Aiden Thompson',
    'Alexandra Davis',
    'Amanda Wilson',
    'Andrew Brown',
    'Angela White',
    'Anthony Lee',
    'Ashley Harris',
    'Benjamin Taylor',
    'Brandon Moore',
    'Brittany Jackson',
    'Caleb Anderson',
    'Cameron Thomas',
    'Caroline Garcia',
    'Christopher Martin',
    'Daniel Rodriguez',
    'David Lewis',
    'Emily Walker',
    'Emma Hall',
    'Ethan Young',
    'Gabriel King',
    'Grace Wright',
    'Hannah Lopez',
    'Isabella Hill',
    'Jacob Scott',
    'James Green',
    'Jessica Adams',
    'John Baker',
    'Jonathan Nelson',
    'Joshua Carter',
    'Justin Mitchell',
    'Katherine Perez',
    'Kevin Roberts',
    'Laura Turner',
    'Lauren Phillips',
    'Madison Campbell',
    'Matthew Parker',
    'Michael Evans',
    'Morgan Edwards',
    'Nathan Collins',
    'Nicholas Stewart',
    'Olivia Sanchez',
    'Rachel Morris',
    'Ryan Rogers',
    'Samantha Reed',
    'Sarah Cook',
    'Stephanie Morgan',
    'Steven Bell',
    'Taylor Murphy',
    'Thomas Bailey',
    'Tyler Rivera',
    'Victoria Cooper',
    'William Richardson',
    'Zachary Cox'
  ];
  
  // Dropdown state
  let dropdownElement = null;
  let isDropdownOpen = false;
  let triggerButton = null;
  let valueSpan = null;
  let selectElement = null;
  let searchInput = null;
  let filteredLeaders = leaders;
  let highlightedIndex = -1;
  
  // Create dropdown HTML element
  function createDropdownElement() {
    if (dropdownElement) {
      return dropdownElement;
    }
    
    dropdownElement = document.createElement('div');
    dropdownElement.id = 'ao-leader-dropdown';
    dropdownElement.className = 'ao-leader-dropdown-menu';
    
    // Dropdown container styles
    dropdownElement.style.cssText = `
      position: absolute !important;
      top: 100% !important;
      left: 0 !important;
      width: 100% !important;
      background: white !important;
      border: 2px solid #000 !important;
      border-top: none !important;
      z-index: 10000 !important;
      display: none !important;
      max-height: 400px !important;
      overflow: hidden !important;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
      margin-top: -1px !important;
    `;
    
    // Search box
    const searchBox = document.createElement('input');
    searchBox.type = 'text';
    searchBox.id = 'ao-leader-search-box';
    searchBox.placeholder = 'Search leaders...';
    searchBox.style.cssText = `
      width: 100% !important;
      padding: 12px 15px !important;
      border: none !important;
      border-bottom: 2px solid #000 !important;
      font-size: 14px !important;
      outline: none !important;
      box-sizing: border-box !important;
      background: white !important;
    `;
    searchInput = searchBox;
    
    // Items container
    const itemsContainer = document.createElement('div');
    itemsContainer.id = 'ao-leader-items';
    itemsContainer.style.cssText = `
      max-height: 320px !important;
      overflow-y: auto !important;
      overflow-x: hidden !important;
    `;
    
    // Create items
    leaders.forEach((leader, index) => {
      const item = document.createElement('div');
      item.className = 'ao-leader-item';
      item.setAttribute('data-leader', leader);
      item.setAttribute('data-index', index);
      item.textContent = leader;
      item.style.cssText = `
        padding: 12px 15px !important;
        cursor: pointer !important;
        border-bottom: 1px solid #e5e5e5 !important;
        background: white !important;
        font-size: 14px !important;
      `;
      
      item.addEventListener('mouseenter', function() {
        if (isDropdownOpen) {
          const itemsContainer = dropdownElement.querySelector('#ao-leader-items');
          const visibleItems = Array.from(itemsContainer.querySelectorAll('.ao-leader-item'))
            .filter(i => i.style.display !== 'none');
          highlightedIndex = visibleItems.indexOf(this);
          updateHighlight();
        }
      });
      
      item.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        selectLeader(leader);
      });
      
      itemsContainer.appendChild(item);
    });
    
    dropdownElement.appendChild(searchBox);
    dropdownElement.appendChild(itemsContainer);
    
    // Search functionality
    searchBox.addEventListener('input', function(e) {
      e.stopPropagation();
      const searchTerm = e.target.value.toLowerCase().trim();
      filterLeaders(searchTerm);
    });
    
    searchBox.addEventListener('keydown', function(e) {
      if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
        e.preventDefault();
        e.stopPropagation();
      }
      handleKeyboard(e);
    });
    
    // Prevent clicks inside dropdown from closing it
    dropdownElement.addEventListener('click', function(e) {
      e.stopPropagation();
    });
    
    dropdownElement.addEventListener('mousedown', function(e) {
      e.stopPropagation();
    });
    
    return dropdownElement;
  }
  
  // Filter leaders based on search
  function filterLeaders(searchTerm) {
    if (!searchTerm) {
      filteredLeaders = leaders;
    } else {
      filteredLeaders = leaders.filter(leader => 
        leader.toLowerCase().includes(searchTerm)
      );
    }
    
    highlightedIndex = -1;
    updateDropdownItems();
  }
  
  // Update dropdown items visibility
  function updateDropdownItems() {
    if (!dropdownElement) return;
    
    const itemsContainer = dropdownElement.querySelector('#ao-leader-items');
    if (!itemsContainer) return;
    
    const items = itemsContainer.querySelectorAll('.ao-leader-item');
    
    items.forEach((item, index) => {
      const leader = item.getAttribute('data-leader');
      const isVisible = filteredLeaders.includes(leader);
      item.style.display = isVisible ? 'block' : 'none';
    });
    
    updateHighlight();
  }
  
  // Update highlighted item
  function updateHighlight() {
    if (!dropdownElement) return;
    
    const itemsContainer = dropdownElement.querySelector('#ao-leader-items');
    if (!itemsContainer) return;
    
    const visibleItems = Array.from(itemsContainer.querySelectorAll('.ao-leader-item'))
      .filter(item => item.style.display !== 'none');
    
    visibleItems.forEach((item, index) => {
      if (index === highlightedIndex) {
        item.style.backgroundColor = '#e5e7eb';
        item.style.fontWeight = '600';
      } else {
        item.style.backgroundColor = 'white';
        item.style.fontWeight = 'normal';
      }
    });
  }
  
  // Handle keyboard navigation
  function handleKeyboard(e) {
    if (!isDropdownOpen || !dropdownElement) return;
    
    const itemsContainer = dropdownElement.querySelector('#ao-leader-items');
    if (!itemsContainer) return;
    
    const visibleItems = Array.from(itemsContainer.querySelectorAll('.ao-leader-item'))
      .filter(item => item.style.display !== 'none');
    
    switch(e.key) {
      case 'ArrowDown':
        e.preventDefault();
        e.stopPropagation();
        highlightedIndex = (highlightedIndex < visibleItems.length - 1) 
          ? highlightedIndex + 1 
          : 0;
        updateHighlight();
        if (visibleItems[highlightedIndex]) {
          visibleItems[highlightedIndex].scrollIntoView({ block: 'nearest', behavior: 'smooth' });
        }
        break;
        
      case 'ArrowUp':
        e.preventDefault();
        e.stopPropagation();
        highlightedIndex = (highlightedIndex > 0) 
          ? highlightedIndex - 1 
          : visibleItems.length - 1;
        updateHighlight();
        if (visibleItems[highlightedIndex]) {
          visibleItems[highlightedIndex].scrollIntoView({ block: 'nearest', behavior: 'smooth' });
        }
        break;
        
      case 'Enter':
        e.preventDefault();
        e.stopPropagation();
        if (highlightedIndex >= 0 && visibleItems[highlightedIndex]) {
          const leader = visibleItems[highlightedIndex].getAttribute('data-leader');
          selectLeader(leader);
        }
        break;
        
      case 'Escape':
        e.preventDefault();
        e.stopPropagation();
        closeDropdown();
        break;
    }
  }
  
  // Select a leader
  function selectLeader(leaderName) {
    console.log('Leader selected:', leaderName);
    
    // Update value span - make it visible and not faded
    if (valueSpan) {
      valueSpan.textContent = leaderName;
      // Remove any faded/placeholder classes
      valueSpan.classList.remove('text-foreground-500');
      valueSpan.classList.add('group-data-[has-value=true]:text-default-foreground');
      // Ensure text is visible and dark
      valueSpan.style.color = '#000000';
      valueSpan.style.opacity = '1';
      valueSpan.style.fontWeight = '500';
    }
    
    // Update select element
    if (selectElement) {
      selectElement.innerHTML = '';
      const option = document.createElement('option');
      option.value = leaderName;
      option.textContent = leaderName;
      selectElement.appendChild(option);
      selectElement.value = leaderName;
      selectElement.dispatchEvent(new Event('change', { bubbles: true }));
    }
    
    // Update button dataset
    if (triggerButton) {
      triggerButton.dataset.selectedLeader = leaderName;
      triggerButton.setAttribute('aria-expanded', 'false');
    }
    
    closeDropdown();
  }
  
  // Position dropdown
  function positionDropdown() {
    if (!dropdownElement || !triggerButton) return;
    
    const rect = triggerButton.getBoundingClientRect();
    
    // Find the correct container - prefer the immediate parent or mainWrapper
    let container = triggerButton.closest('[data-slot="mainWrapper"]');
    
    // If no mainWrapper, try parent element
    if (!container) {
      container = triggerButton.parentElement;
    }
    
    // If still no container, find closest div
    if (!container) {
      container = triggerButton.closest('div');
    }
    
    // Fallback to form if nothing else works
    if (!container) {
      container = triggerButton.closest('.reg-form') || triggerButton.closest('form');
    }
    
    if (container) {
      // Ensure container has relative positioning
      const computedStyle = window.getComputedStyle(container);
      if (computedStyle.position === 'static' || !computedStyle.position) {
        container.style.position = 'relative';
      }
      
      // Remove dropdown from any other parent first
      if (dropdownElement.parentElement && dropdownElement.parentElement !== container) {
        dropdownElement.parentElement.removeChild(dropdownElement);
      }
      
      // Append to correct container
      if (!container.contains(dropdownElement)) {
        container.appendChild(dropdownElement);
      }
      
      // Ensure dropdown is positioned correctly
      dropdownElement.style.position = 'absolute';
      dropdownElement.style.top = '100%';
      dropdownElement.style.left = '0';
      dropdownElement.style.width = '100%';
      dropdownElement.style.zIndex = '99999';
      dropdownElement.style.marginTop = '-1px';
    }
  }
  
  // Open dropdown
  function openDropdown() {
    if (isDropdownOpen) return;
    
    console.log('Opening dropdown');
    
    if (!dropdownElement) {
      createDropdownElement();
    }
    
    // Reset search
    if (searchInput) {
      searchInput.value = '';
    }
    filteredLeaders = leaders;
    highlightedIndex = -1;
    updateDropdownItems();
    
    // Position dropdown BEFORE showing it
    positionDropdown();
    
    // Show dropdown
    dropdownElement.style.display = 'block';
    isDropdownOpen = true;
    
    // Reposition after a brief delay to ensure DOM is ready
    setTimeout(() => {
      positionDropdown();
    }, 10);
    
    // Focus search box
    if (searchInput) {
      setTimeout(() => {
        searchInput.focus();
      }, 50);
    }
    
    // Update button aria
    if (triggerButton) {
      triggerButton.setAttribute('aria-expanded', 'true');
    }
    
    // Setup click outside handler
    setTimeout(() => {
      document.addEventListener('click', handleClickOutside);
      document.addEventListener('keydown', handleEscapeKey);
    }, 100);
  }
  
  // Close dropdown
  function closeDropdown() {
    if (!isDropdownOpen) return;
    
    console.log('Closing dropdown');
    
    if (dropdownElement) {
      dropdownElement.style.display = 'none';
    }
    
    if (searchInput) {
      searchInput.value = '';
    }
    
    filteredLeaders = leaders;
    highlightedIndex = -1;
    
    isDropdownOpen = false;
    
    // Update button aria
    if (triggerButton) {
      triggerButton.setAttribute('aria-expanded', 'false');
    }
    
    // Remove event listeners
    document.removeEventListener('click', handleClickOutside);
    document.removeEventListener('keydown', handleEscapeKey);
  }
  
  // Handle click outside
  function handleClickOutside(e) {
    if (!isDropdownOpen) return;
    
    // Check if click is outside dropdown and button
    const clickedInsideDropdown = dropdownElement && dropdownElement.contains(e.target);
    const clickedInsideButton = triggerButton && (triggerButton.contains(e.target) || triggerButton === e.target);
    
    // Check if clicking on country code elements (don't close leader dropdown if so)
    const clickedOnCountryCode = e.target.closest && (
      e.target.closest('.country-code-selector') ||
      e.target.closest('.country-code-button') ||
      e.target.closest('.country-code-dropdown') ||
      e.target.classList.contains('country-code-button') ||
      e.target.classList.contains('country-code-dropdown') ||
      e.target.classList.contains('country-code-selector')
    );
    
    // Also check if target itself is a country code element
    const isCountryCodeElement = e.target.classList && (
      e.target.classList.contains('country-code-button') ||
      e.target.classList.contains('country-code-dropdown') ||
      e.target.classList.contains('country-code-selector') ||
      e.target.classList.contains('country-code-search') ||
      e.target.classList.contains('country-code-option') ||
      e.target.classList.contains('country-code-options-container')
    );
    
    if (!clickedInsideDropdown && !clickedInsideButton && !clickedOnCountryCode && !isCountryCodeElement) {
      closeDropdown();
    }
  }
  
  // Handle escape key
  function handleEscapeKey(e) {
    if (e.key === 'Escape' && isDropdownOpen) {
      closeDropdown();
    }
  }
  
  // Initialize dropdown
  function initDropdown() {
    console.log('Initializing dropdown...');
    
    // Find trigger button
    const selectors = [
      'button#react-aria-\\:R25icv6jaH2\\:',
      'button[data-slot="trigger"]',
      'button[aria-haspopup="listbox"]:not(.country-code-button)'
    ];
    
    for (const selector of selectors) {
      triggerButton = document.querySelector(selector);
      if (triggerButton) {
        console.log('Found trigger button:', selector);
        break;
      }
    }
    
    if (!triggerButton) {
      console.log('Trigger button not found, retrying...');
      setTimeout(initDropdown, 500);
      return;
    }
    
    // Find value span
    valueSpan = document.querySelector('span#react-aria-\\:R25icv6jaH7\\:');
    if (!valueSpan && triggerButton) {
      valueSpan = triggerButton.querySelector('span[data-slot="value"]');
    }
    
    // Find select element
    selectElement = document.querySelector('select[name="select"]');
    if (!selectElement) {
      selectElement = document.querySelector('[data-testid="hidden-select-container"] select');
    }
    
    // Setup button click handler
    function handleButtonClick(e) {
      e.preventDefault();
      e.stopPropagation();
      
      if (isDropdownOpen) {
        closeDropdown();
      } else {
        openDropdown();
      }
    }
    
    // Remove any existing listeners by cloning (if needed) or just attach directly
    // Check if button already has our handler to avoid duplicates
    // Use capture phase for event delegation to catch clicks on button and all children
    if (!triggerButton.dataset.leaderButtonInitialized) {
      triggerButton.addEventListener('click', handleButtonClick, true); // Capture phase for event delegation
      triggerButton.dataset.leaderButtonInitialized = 'true';
    }
    
    triggerButton.style.cursor = 'pointer';
    triggerButton.style.pointerEvents = 'auto';
    
    // Make sure all current children are clickable
    const children = triggerButton.querySelectorAll('*');
    children.forEach(child => {
      child.style.pointerEvents = 'auto';
      child.style.cursor = 'pointer';
    });
    
    // Watch for changes to button children and ensure they remain clickable
    const buttonObserver = new MutationObserver(() => {
      const currentChildren = triggerButton.querySelectorAll('*');
      currentChildren.forEach(child => {
        child.style.pointerEvents = 'auto';
        child.style.cursor = 'pointer';
      });
      
      // Ensure click handler is still attached (in case button was replaced)
      if (triggerButton && !triggerButton.dataset.leaderButtonInitialized) {
        triggerButton.addEventListener('click', handleButtonClick, true);
        triggerButton.dataset.leaderButtonInitialized = 'true';
      }
    });
    
    buttonObserver.observe(triggerButton, {
      childList: true,
      subtree: true
    });
    
    // Re-find value span in case it changed
    if (!valueSpan) {
      valueSpan = triggerButton.querySelector('span#react-aria-\\:R25icv6jaH7\\:');
      if (!valueSpan) {
        valueSpan = triggerButton.querySelector('span[data-slot="value"]');
      }
    }
    
    // Handle window resize/scroll - reposition dropdown
    window.addEventListener('scroll', () => {
      if (isDropdownOpen && dropdownElement) {
        positionDropdown();
      }
    }, true);
    
    window.addEventListener('resize', () => {
      if (isDropdownOpen && dropdownElement) {
        positionDropdown();
      }
    });
    
    // Store container reference for observers
    const container = triggerButton.closest('[data-slot="mainWrapper"]') || 
                     triggerButton.parentElement ||
                     triggerButton.closest('div');
    
    // Watch for layout changes that might affect dropdown position
    if (container) {
      const layoutObserver = new MutationObserver(() => {
        if (isDropdownOpen && dropdownElement) {
          positionDropdown();
        }
      });
      
      layoutObserver.observe(container, {
        attributes: true,
        attributeFilter: ['style', 'class'],
        childList: true,
        subtree: false
      });
    }
    
    console.log('Dropdown initialized successfully');
  }
  
  // Function to ensure AO Leader has a label above it
  function ensureLeaderLabel() {
    const form = document.querySelector('.reg-form');
    if (!form) return;
    
    const leaderButton = form.querySelector('button[data-slot="trigger"]:not(.country-code-button)') ||
                        form.querySelector('button[aria-haspopup="listbox"]:not(.country-code-button)');
    
    if (!leaderButton) return;
    
    // Find the container
    const container = leaderButton.closest('[data-slot="mainWrapper"]') || 
                     leaderButton.parentElement;
    
    if (!container) return;
    
    // Check if label already exists
    let label = container.querySelector('label[for*="leader"], label[for*="select"]');
    
    // Also check for label before the button
    const buttonParent = leaderButton.parentElement;
    if (buttonParent) {
      const siblings = Array.from(buttonParent.children);
      const buttonIndex = siblings.indexOf(leaderButton);
      if (buttonIndex > 0) {
        const prevSibling = siblings[buttonIndex - 1];
        if (prevSibling.tagName === 'LABEL') {
          label = prevSibling;
        }
      }
    }
    
    // Create label if it doesn't exist
    if (!label) {
      label = document.createElement('label');
      label.textContent = 'Select AO Leader ';
      const asterisk = document.createElement('span');
      asterisk.className = 'text-red-500';
      asterisk.textContent = '*';
      label.appendChild(asterisk);
      // For phone view: inline-block, for desktop: block (handled by CSS)
      label.style.cssText = 'display: inline-block; font-size: 0.875rem; font-weight: 500; color: #374151; margin: 0; white-space: nowrap; flex-shrink: 0;';
      
      // Insert before button
      if (leaderButton.parentElement) {
        leaderButton.parentElement.insertBefore(label, leaderButton);
      } else if (container) {
        container.insertBefore(label, leaderButton);
      }
    } else {
      // Ensure existing label is visible and positioned correctly
      label.style.display = 'inline-block';
      label.style.fontSize = '0.875rem';
      label.style.fontWeight = '500';
      label.style.color = '#374151';
      label.style.margin = '0';
      label.style.visibility = 'visible';
      label.style.opacity = '1';
      label.style.whiteSpace = 'nowrap';
      label.style.flexShrink = '0';
    }
  }
  
  // Start initialization
  function startInit() {
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        setTimeout(initDropdown, 100);
        setTimeout(initDropdown, 500);
        setTimeout(initDropdown, 1000);
        setTimeout(ensureLeaderLabel, 200);
        setTimeout(ensureLeaderLabel, 600);
        setTimeout(ensureLeaderLabel, 1100);
      });
    } else {
      setTimeout(initDropdown, 100);
      setTimeout(initDropdown, 500);
      setTimeout(initDropdown, 1000);
      setTimeout(ensureLeaderLabel, 200);
      setTimeout(ensureLeaderLabel, 600);
      setTimeout(ensureLeaderLabel, 1100);
    }
    
    // Watch for button creation or replacement
    const observer = new MutationObserver(() => {
      const button = document.querySelector('button[data-slot="trigger"]') ||
                    document.querySelector('button[aria-haspopup="listbox"]:not(.country-code-button)');
      
      // Re-initialize if:
      // 1. No triggerButton exists yet, OR
      // 2. Button exists but doesn't have our initialization flag, OR
      // 3. Button was replaced (different element)
      if (button && (!triggerButton || button !== triggerButton || !button.dataset.leaderButtonInitialized)) {
        // Reset triggerButton so initDropdown will find the new one
        triggerButton = null;
        initDropdown();
      }
    });
    
    observer.observe(document.body, {
      childList: true,
      subtree: true
    });
    
    // Watch for leader button changes and ensure label exists
    const leaderObserver = new MutationObserver(() => {
      ensureLeaderLabel();
    });
    
    leaderObserver.observe(document.body, {
      childList: true,
      subtree: true
    });
  }
  
  startInit();
  
  // ============================================
  // COUNTRY CODE SELECTOR WITH FLAG
  // ============================================
  
  // Country code data with flags (using emoji flags)
  const countryCodes = [
    { code: '+1', flag: 'ðŸ‡ºðŸ‡¸', name: 'United States', dialCode: '+1' },
    { code: '+1', flag: 'ðŸ‡¨ðŸ‡¦', name: 'Canada', dialCode: '+1' },
    { code: '+44', flag: 'ðŸ‡¬ðŸ‡§', name: 'United Kingdom', dialCode: '+44' },
    { code: '+61', flag: 'ðŸ‡¦ðŸ‡º', name: 'Australia', dialCode: '+61' },
    { code: '+91', flag: 'ðŸ‡®ðŸ‡³', name: 'India', dialCode: '+91' },
    { code: '+86', flag: 'ðŸ‡¨ðŸ‡³', name: 'China', dialCode: '+86' },
    { code: '+81', flag: 'ðŸ‡¯ðŸ‡µ', name: 'Japan', dialCode: '+81' },
    { code: '+49', flag: 'ðŸ‡©ðŸ‡ª', name: 'Germany', dialCode: '+49' },
    { code: '+33', flag: 'ðŸ‡«ðŸ‡·', name: 'France', dialCode: '+33' },
    { code: '+39', flag: 'ðŸ‡®ðŸ‡¹', name: 'Italy', dialCode: '+39' },
    { code: '+34', flag: 'ðŸ‡ªðŸ‡¸', name: 'Spain', dialCode: '+34' },
    { code: '+7', flag: 'ðŸ‡·ðŸ‡º', name: 'Russia', dialCode: '+7' },
    { code: '+55', flag: 'ðŸ‡§ðŸ‡·', name: 'Brazil', dialCode: '+55' },
    { code: '+52', flag: 'ðŸ‡²ðŸ‡½', name: 'Mexico', dialCode: '+52' },
    { code: '+27', flag: 'ðŸ‡¿ðŸ‡¦', name: 'South Africa', dialCode: '+27' },
    { code: '+82', flag: 'ðŸ‡°ðŸ‡·', name: 'South Korea', dialCode: '+82' },
    { code: '+65', flag: 'ðŸ‡¸ðŸ‡¬', name: 'Singapore', dialCode: '+65' },
    { code: '+971', flag: 'ðŸ‡¦ðŸ‡ª', name: 'UAE', dialCode: '+971' },
    { code: '+966', flag: 'ðŸ‡¸ðŸ‡¦', name: 'Saudi Arabia', dialCode: '+966' },
    { code: '+60', flag: 'ðŸ‡²ðŸ‡¾', name: 'Malaysia', dialCode: '+60' },
    { code: '+62', flag: 'ðŸ‡®ðŸ‡©', name: 'Indonesia', dialCode: '+62' },
    { code: '+31', flag: 'ðŸ‡³ðŸ‡±', name: 'Netherlands', dialCode: '+31' },
    { code: '+32', flag: 'ðŸ‡§ðŸ‡ª', name: 'Belgium', dialCode: '+32' },
    { code: '+41', flag: 'ðŸ‡¨ðŸ‡­', name: 'Switzerland', dialCode: '+41' },
    { code: '+43', flag: 'ðŸ‡¦ðŸ‡¹', name: 'Austria', dialCode: '+43' },
    { code: '+45', flag: 'ðŸ‡©ðŸ‡°', name: 'Denmark', dialCode: '+45' },
    { code: '+46', flag: 'ðŸ‡¸ðŸ‡ª', name: 'Sweden', dialCode: '+46' },
    { code: '+47', flag: 'ðŸ‡³ðŸ‡´', name: 'Norway', dialCode: '+47' },
    { code: '+358', flag: 'ðŸ‡«ðŸ‡®', name: 'Finland', dialCode: '+358' },
    { code: '+353', flag: 'ðŸ‡®ðŸ‡ª', name: 'Ireland', dialCode: '+353' },
    { code: '+351', flag: 'ðŸ‡µðŸ‡¹', name: 'Portugal', dialCode: '+351' },
    { code: '+48', flag: 'ðŸ‡µðŸ‡±', name: 'Poland', dialCode: '+48' },
    { code: '+420', flag: 'ðŸ‡¨ðŸ‡¿', name: 'Czech Republic', dialCode: '+420' },
    { code: '+36', flag: 'ðŸ‡­ðŸ‡º', name: 'Hungary', dialCode: '+36' },
    { code: '+40', flag: 'ðŸ‡·ðŸ‡´', name: 'Romania', dialCode: '+40' },
    { code: '+30', flag: 'ðŸ‡¬ðŸ‡·', name: 'Greece', dialCode: '+30' },
    { code: '+90', flag: 'ðŸ‡¹ðŸ‡·', name: 'Turkey', dialCode: '+90' },
    { code: '+64', flag: 'ðŸ‡³ðŸ‡¿', name: 'New Zealand', dialCode: '+64' },
    { code: '+63', flag: 'ðŸ‡µðŸ‡­', name: 'Philippines', dialCode: '+63' },
    { code: '+66', flag: 'ðŸ‡¹ðŸ‡­', name: 'Thailand', dialCode: '+66' },
    { code: '+84', flag: 'ðŸ‡»ðŸ‡³', name: 'Vietnam', dialCode: '+84' },
    { code: '+852', flag: 'ðŸ‡­ðŸ‡°', name: 'Hong Kong', dialCode: '+852' },
    { code: '+853', flag: 'ðŸ‡²ðŸ‡´', name: 'Macau', dialCode: '+853' },
    { code: '+886', flag: 'ðŸ‡¹ðŸ‡¼', name: 'Taiwan', dialCode: '+886' },
    { code: '+92', flag: 'ðŸ‡µðŸ‡°', name: 'Pakistan', dialCode: '+92' },
    { code: '+880', flag: 'ðŸ‡§ðŸ‡©', name: 'Bangladesh', dialCode: '+880' },
    { code: '+94', flag: 'ðŸ‡±ðŸ‡°', name: 'Sri Lanka', dialCode: '+94' },
    { code: '+95', flag: 'ðŸ‡²ðŸ‡²', name: 'Myanmar', dialCode: '+95' },
    { code: '+977', flag: 'ðŸ‡³ðŸ‡µ', name: 'Nepal', dialCode: '+977' },
    { code: '+960', flag: 'ðŸ‡²ðŸ‡»', name: 'Maldives', dialCode: '+960' },
    { code: '+974', flag: 'ðŸ‡¶ðŸ‡¦', name: 'Qatar', dialCode: '+974' },
    { code: '+965', flag: 'ðŸ‡°ðŸ‡¼', name: 'Kuwait', dialCode: '+965' },
    { code: '+973', flag: 'ðŸ‡§ðŸ‡­', name: 'Bahrain', dialCode: '+973' },
    { code: '+968', flag: 'ðŸ‡´ðŸ‡²', name: 'Oman', dialCode: '+968' },
    { code: '+961', flag: 'ðŸ‡±ðŸ‡§', name: 'Lebanon', dialCode: '+961' },
    { code: '+962', flag: 'ðŸ‡¯ðŸ‡´', name: 'Jordan', dialCode: '+962' },
    { code: '+972', flag: 'ðŸ‡®ðŸ‡±', name: 'Israel', dialCode: '+972' },
    { code: '+20', flag: 'ðŸ‡ªðŸ‡¬', name: 'Egypt', dialCode: '+20' },
    { code: '+212', flag: 'ðŸ‡²ðŸ‡¦', name: 'Morocco', dialCode: '+212' },
    { code: '+213', flag: 'ðŸ‡©ðŸ‡¿', name: 'Algeria', dialCode: '+213' },
    { code: '+234', flag: 'ðŸ‡³ðŸ‡¬', name: 'Nigeria', dialCode: '+234' },
    { code: '+254', flag: 'ðŸ‡°ðŸ‡ª', name: 'Kenya', dialCode: '+254' },
    { code: '+233', flag: 'ðŸ‡¬ðŸ‡­', name: 'Ghana', dialCode: '+233' },
    { code: '+256', flag: 'ðŸ‡ºðŸ‡¬', name: 'Uganda', dialCode: '+256' },
    { code: '+255', flag: 'ðŸ‡¹ðŸ‡¿', name: 'Tanzania', dialCode: '+255' },
    { code: '+54', flag: 'ðŸ‡¦ðŸ‡·', name: 'Argentina', dialCode: '+54' },
    { code: '+56', flag: 'ðŸ‡¨ðŸ‡±', name: 'Chile', dialCode: '+56' },
    { code: '+57', flag: 'ðŸ‡¨ðŸ‡´', name: 'Colombia', dialCode: '+57' },
    { code: '+51', flag: 'ðŸ‡µðŸ‡ª', name: 'Peru', dialCode: '+51' },
    { code: '+58', flag: 'ðŸ‡»ðŸ‡ª', name: 'Venezuela', dialCode: '+58' },
    { code: '+593', flag: 'ðŸ‡ªðŸ‡¨', name: 'Ecuador', dialCode: '+593' },
    { code: '+595', flag: 'ðŸ‡µðŸ‡¾', name: 'Paraguay', dialCode: '+595' },
    { code: '+598', flag: 'ðŸ‡ºðŸ‡¾', name: 'Uruguay', dialCode: '+598' },
    { code: '+591', flag: 'ðŸ‡§ðŸ‡´', name: 'Bolivia', dialCode: '+591' },
    { code: '+506', flag: 'ðŸ‡¨ðŸ‡·', name: 'Costa Rica', dialCode: '+506' },
    { code: '+507', flag: 'ðŸ‡µðŸ‡¦', name: 'Panama', dialCode: '+507' },
    { code: '+502', flag: 'ðŸ‡¬ðŸ‡¹', name: 'Guatemala', dialCode: '+502' },
    { code: '+504', flag: 'ðŸ‡­ðŸ‡³', name: 'Honduras', dialCode: '+504' },
    { code: '+505', flag: 'ðŸ‡³ðŸ‡®', name: 'Nicaragua', dialCode: '+505' },
    { code: '+503', flag: 'ðŸ‡¸ðŸ‡»', name: 'El Salvador', dialCode: '+503' }
  ];
  
  // Add CSS for country code selector
  const style = document.createElement('style');
  style.textContent = `
    .phone-input-wrapper {
      position: relative;
      display: flex;
      align-items: stretch;
      gap: 0.5rem;
      width: 100%;
    }
    
    .country-code-selector {
      position: relative;
      display: inline-block;
      flex: 0 0 auto;
      z-index: 1000;
    }
    
    .country-code-button {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 0.5rem 0.75rem;
      background: white;
      border: 1px solid #9ca3af;
      border-radius: 0.375rem;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      color: #374151;
      transition: all 0.2s;
      user-select: none;
      min-width: 6rem;
      min-height: 2.5rem;
      justify-content: center;
      box-sizing: border-box;
    }
    
    .country-code-button:hover {
      background: #e5e7eb;
      border-color: #9ca3af;
    }
    
    .country-code-button:focus {
      outline: 2px solid #3b82f6;
      outline-offset: -2px;
    }
    
    .country-code-button .flag {
      font-size: 18px;
      line-height: 1;
    }
    
    .country-code-button .arrow {
      font-size: 10px;
      transition: transform 0.2s;
      color: #6b7280;
    }
    
    .country-code-button.open .arrow {
      transform: rotate(180deg);
    }
    
    .country-code-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 4px;
      background: white;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      max-height: 300px;
      overflow-y: auto;
      overflow-x: hidden;
      z-index: 10000;
      min-width: 200px;
      display: none;
    }
    
    .country-code-dropdown.open {
      display: block;
    }
    
    .country-code-search {
      padding: 8px 12px;
      border-bottom: 1px solid #e5e7eb;
      position: sticky;
      top: 0;
      background: white;
      z-index: 10;
    }
    
    .country-code-search input {
      width: 100%;
      padding: 6px 10px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
      font-size: 14px;
      outline: none;
    }
    
    .country-code-search input:focus {
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .country-code-options-container {
      max-height: 250px;
      overflow-y: auto;
      overflow-x: hidden;
    }
    
    .country-code-option {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      cursor: pointer;
      transition: background 0.15s;
      font-size: 14px;
    }
    
    .country-code-option.hidden {
      display: none;
    }
    
    .country-code-option:hover {
      background: #f3f4f6;
    }
    
    .country-code-option .flag {
      font-size: 20px;
      line-height: 1;
    }
    
    .country-code-option .dial-code {
      font-weight: 500;
      color: #374151;
      min-width: 50px;
    }
    
    .country-code-option .country-name {
      color: #6b7280;
      flex: 1;
    }
    
    .phone-input-wrapper input[name="phone"],
    .phone-input-wrapper input[type="tel"] {
      border-radius: 0.375rem;
      border: 1px solid #9ca3af;
      flex: 1;
      min-height: 2.5rem;
      box-sizing: border-box;
    }
    
    .phone-input-wrapper input[name="phone"]:focus,
    .phone-input-wrapper input[type="tel"]:focus {
      border-color: #3b82f6;
    }
    
    /* Hide language selector button from form (footer links still work) */
    .language-selector-wrapper,
    .language-selector-button,
    .reg-form .language-selector-wrapper,
    .reg-form .language-selector-button {
      display: none !important;
      visibility: hidden !important;
      height: 0 !important;
      margin: 0 !important;
      padding: 0 !important;
    }
    
    /* Ensure AO Leader container has relative positioning for dropdown */
    .reg-form [data-slot="mainWrapper"],
    .reg-form > div:has(button[data-slot="trigger"]) {
      position: relative !important;
      overflow: visible !important;
    }
    
    /* Ensure dropdown appears correctly on desktop */
    .reg-form #ao-leader-dropdown,
    .reg-form .ao-leader-dropdown-menu {
      position: absolute !important;
      top: 100% !important;
      left: 0 !important;
      width: 100% !important;
      z-index: 99999 !important;
      margin-top: -1px !important;
    }
    
    /* Hide the "Select AO Leader" label inside the button on desktop */
    .reg-form button[data-slot="trigger"] label[data-slot="label"],
    .reg-form button[aria-haspopup="listbox"]:not(.country-code-button) label[data-slot="label"],
    .reg-form button[data-slot="trigger"] label,
    .reg-form button[aria-haspopup="listbox"]:not(.country-code-button) label {
      display: none !important;
      visibility: hidden !important;
      height: 0 !important;
      width: 0 !important;
      margin: 0 !important;
      padding: 0 !important;
      opacity: 0 !important;
    }
    
    /* PC View: Leader label next to input box */
    @media (min-width: 769px) {
      /* Make container horizontal (row) for PC view so label appears next to input */
      .reg-form > div:has(button[data-slot="trigger"]),
      .reg-form [data-slot="mainWrapper"] {
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        gap: 0.75rem !important;
      }
      
      /* Ensure AO Leader label is visible next to dropdown on desktop */
      .reg-form > div:has(button[data-slot="trigger"]) > label,
      .reg-form [data-slot="mainWrapper"] > label,
      .reg-form > div:has(button[data-slot="trigger"]) label:first-child,
      .reg-form label[for*="leader"],
      .reg-form label[for*="select"] {
        display: inline-block !important;
        font-size: 0.875rem !important;
        font-weight: 500 !important;
        color: #374151 !important;
        margin-bottom: 0 !important;
        margin-top: 0 !important;
        visibility: visible !important;
        opacity: 1 !important;
        white-space: nowrap !important;
        flex-shrink: 0 !important;
        position: relative !important;
        z-index: 1 !important;
      }
      
      /* Ensure button doesn't overlap label */
      .reg-form > div:has(button[data-slot="trigger"]) button[data-slot="trigger"],
      .reg-form [data-slot="mainWrapper"] button[data-slot="trigger"],
      .reg-form button[aria-haspopup="listbox"]:not(.country-code-button) {
        position: relative !important;
        z-index: 0 !important;
      }
      
      /* Create label if missing - desktop view */
      .reg-form > div:has(button[data-slot="trigger"]):not(:has(label))::before {
        content: "Select AO Leader *" !important;
        display: inline-block !important;
        font-size: 0.875rem !important;
        font-weight: 500 !important;
        color: #374151 !important;
        margin-bottom: 0 !important;
        white-space: nowrap !important;
        flex-shrink: 0 !important;
      }
      
      /* Make button flex to fill remaining space and ensure it doesn't overlap label */
      .reg-form > div:has(button[data-slot="trigger"]) button[data-slot="trigger"],
      .reg-form [data-slot="mainWrapper"] button[data-slot="trigger"],
      .reg-form button[aria-haspopup="listbox"]:not(.country-code-button) {
        flex: 1 !important;
        width: auto !important;
        position: relative !important;
        z-index: 0 !important;
      }
      
      /* Ensure pseudo-element label also has proper z-index */
      .reg-form > div:has(button[data-slot="trigger"]):not(:has(label))::before {
        position: relative !important;
        z-index: 1 !important;
      }
    }
    
    /* Make button smaller on desktop */
    .reg-form button[data-slot="trigger"],
    .reg-form button[aria-haspopup="listbox"]:not(.country-code-button) {
      height: auto !important;
      min-height: 2.5rem !important;
      max-height: 2.5rem !important;
      padding: 0.5rem 0.75rem !important;
      padding-top: 0.5rem !important;
      padding-bottom: 0.5rem !important;
      line-height: 1.5 !important;
    }
    
    /* Adjust inner wrapper padding when label is hidden on desktop */
    .reg-form button[data-slot="trigger"] [data-slot="innerWrapper"],
    .reg-form button[aria-haspopup="listbox"]:not(.country-code-button) [data-slot="innerWrapper"] {
      padding-top: 0 !important;
      height: auto !important;
      min-height: auto !important;
    }
    
    /* Form input container */
    .reg-form .mb-4 {
      margin-bottom: 1rem;
    }
    
    /* Label styling - positioned above input */
    .reg-form label:not(.country-code-dropdown label) {
      display: block;
      font-size: 0.875rem;
      font-weight: 500;
      color: #374151;
      margin-bottom: 0.25rem;
    }
    
    /* Input styling - normal padding, no extra top padding */
    .reg-form input[type="text"]:not([name="phone"]):not(.country-code-search input),
    .reg-form input[type="email"],
    .reg-form input[name="firstName"],
    .reg-form input[name="lastName"],
    .reg-form input[name="email"]:not([name="phone"]) {
      width: 100%;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      padding: 0.5rem;
      font-size: 16px;
      background: white;
      transition: all 0.2s;
      box-sizing: border-box;
    }
    
    /* Focus state */
    .reg-form input[type="text"]:not([name="phone"]):not(.country-code-search input):focus,
    .reg-form input[type="email"]:focus,
    .reg-form input[name="firstName"]:focus,
    .reg-form input[name="lastName"]:focus,
    .reg-form input[name="email"]:not([name="phone"]):focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5);
    }
    
    /* Required field indicator */
    .reg-form .text-red-500 {
      color: #ef4444;
    }
    
    /* Mobile view - move images to top */
    @media (max-width: 768px) {
      /* Prevent horizontal overflow */
      html, body {
        overflow-x: hidden !important;
        max-width: 100vw !important;
        width: 100% !important;
      }
      
      * {
        max-width: 100% !important;
        box-sizing: border-box !important;
      }
      
      /* Reduce padding and margins globally */
      body {
        padding: 0 !important;
        margin: 0 !important;
      }
      
      body > * {
        padding-left: 0.5rem !important;
        padding-right: 0.5rem !important;
        margin-left: auto !important;
        margin-right: auto !important;
      }
      
      /* Reduce spacing between sections */
      section, div[class*="section"], div[class*="container"] {
        padding: 0.75rem !important;
        margin: 0.5rem 0 !important;
      }
      
      /* Reduce form element spacing */
      form > * {
        margin-bottom: 0.75rem !important;
      }
      
      /* Style images for mobile */
      img {
        width: 100% !important;
        max-width: 100% !important;
        height: auto;
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
      }
      
      /* Show images that are hidden on desktop but should be visible on mobile */
      img[class*="hidden"],
      div[class*="hidden"] img,
      div[class*="hidden"][class*="lg:block"] img,
      div[class*="hidden"][class*="lg:block"] {
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
      }
      
      /* Show sidebar background image on mobile and position at top */
      div[class*="sidebar-bg"],
      div[class*="bg-\\[url"],
      div[class*="bg-\\[url\\('/sidebar-bg.png'"],
      div[class*="hidden"][class*="lg:block"],
      div.bg-\\[url\\('/sidebar-bg.png'\\),
      div[class*="w-1/3"][class*="bg-"] {
        display: block !important;
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        width: 100% !important;
        height: 150px !important;
        z-index: 0;
        background-size: cover !important;
        background-position: center top !important;
        background-repeat: no-repeat !important;
        visibility: visible !important;
        opacity: 1 !important;
      }
      
      /* Show image containers that might be hidden */
      div[class*="hidden"][class*="lg:block"],
      div[class*="w-1/3"],
      picture[class*="hidden"],
      section[class*="hidden"] {
        display: block !important;
        visibility: visible !important;
        opacity: 1 !important;
      }
      
      /* Ensure content is below the image */
      body > *:not(div[class*="sidebar-bg"]):not(div[class*="bg-\\[url"]) {
        position: relative;
        z-index: 1;
        margin-top: 0 !important;
      }
      
      /* Reduce text sizes if needed */
      h1 { font-size: 1.5rem !important; }
      h2 { font-size: 1.25rem !important; }
      h3 { font-size: 1.1rem !important; }
      p, span, div { font-size: 0.9rem !important; }
      
      /* Ensure inputs and buttons fit - but exclude buttons from width constraint */
      input:not([type="button"]):not([type="submit"]):not(.country-code-button):not(button),
      textarea, 
      select {
        width: 100% !important;
        max-width: 100% !important;
        padding: 0.5rem !important;
        font-size: 16px !important; /* Prevents zoom on iOS */
      }
      
      /* Buttons should maintain their natural width - except submit button */
      button:not([type="submit"]),
      input[type="button"],
      .country-code-button {
        width: auto !important;
        max-width: none !important;
      }
      
      /* Submit button should be full width */
      button[type="submit"],
      input[type="submit"] {
        width: 100% !important;
      }
      
      /* Form container styling for mobile - modern and organized */
      form.reg-form {
        width: 100% !important;
        max-width: 28rem !important;
        margin-left: auto !important;
        margin-right: auto !important;
        padding: 1.5rem !important;
        background: white !important;
        border-radius: 0.75rem !important;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06) !important;
      }
      
      /* Form spacing - modern spacing for phone view */
      form.reg-form > * + * {
        margin-top: 1rem !important;
      }
      
      /* Form input container for mobile - modern structure */
      form .mb-4,
      form > div:has(input),
      form > div:has(input[type="text"]),
      form > div:has(input[type="email"]),
      form > div:has(input[name="firstName"]),
      form > div:has(input[name="lastName"]),
      form > div:has(input[name="email"]) {
        display: flex !important;
        flex-direction: column !important;
        margin-bottom: 0 !important;
        gap: 0.5rem !important;
        position: static !important;
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important;
        z-index: auto !important;
      }
      
      /* AO Leader container - label next to input, allow button to expand */
      form > div:has(button[data-slot="trigger"]),
      form [data-slot="mainWrapper"],
      form [data-slot="input-wrapper"] {
        display: flex !important;
        flex-direction: row !important;
        align-items: center !important;
        gap: 0.75rem !important;
        margin-bottom: 0 !important;
        position: relative !important;
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important;
        z-index: auto !important;
        width: 100% !important;
      }
      
      /* Remove any wrapper boxes that might be covering content */
      form > div > div:has(input),
      form > div > div:has(label) {
        position: static !important;
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important;
        margin: 0 !important;
        z-index: auto !important;
      }
      
      /* Label styling - modern typography and spacing */
      form label:not(.country-code-dropdown label) {
        display: block !important;
        font-size: 0.875rem !important;
        font-weight: 600 !important;
        color: #111827 !important;
        margin-bottom: 0 !important;
        margin-top: 0 !important;
        padding-bottom: 0 !important;
        position: static !important;
        left: auto !important;
        top: auto !important;
        background: transparent !important;
        padding: 0 !important;
        pointer-events: auto !important;
        z-index: auto !important;
        line-height: 1.5 !important;
        letter-spacing: -0.01em !important;
      }
      
      /* Required field asterisk styling */
      form label .text-red-500,
      form label span.text-red-500,
      form label::after {
        color: #ef4444 !important;
        font-weight: 600 !important;
        margin-left: 0.125rem !important;
      }
      
      /* Hide language selector from form */
      form .language-selector-wrapper,
      form .language-selector-button,
      form .language-dropdown {
        display: none !important;
        visibility: hidden !important;
        height: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
      }
      
      /* Exclude phone-input-wrapper and country-code structures */
      form .phone-input-wrapper {
        position: relative !important;
        margin-bottom: 0 !important;
        background: transparent !important;
      }
      
      form .country-code-selector {
        position: relative !important;
        margin-bottom: 0 !important;
        background: transparent !important;
        z-index: 1000 !important;
      }
      
      form .country-code-dropdown {
        position: absolute !important;
        z-index: 10000 !important;
        margin-bottom: 0 !important;
      }
      
      /* Remove any relative positioning wrappers that create boxes */
      form .relative,
      form .relative.mb-4 {
        position: static !important;
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important;
        margin-bottom: 0 !important;
      }
      
      /* Remove boxes from any wrapper divs */
      form > div > div,
      form div[class*="wrapper"]:not(.phone-input-wrapper):not(.country-code-dropdown),
      form div[class*="container"] {
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important;
        position: static !important;
      }
      
      /* Input styling - modern design */
      form input[type="text"]:not([name="phone"]):not(.country-code-search input),
      form input[type="email"],
      form input[name="firstName"],
      form input[name="lastName"],
      form input[name="email"]:not([name="phone"]) {
        width: 100% !important;
        border: 1.5px solid #e5e7eb !important;
        border-radius: 0.5rem !important;
        padding: 0.75rem 1rem !important;
        font-size: 0.9375rem !important;
        background: #ffffff !important;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
        box-sizing: border-box !important;
        position: relative !important;
        z-index: auto !important;
        margin-top: 0 !important;
        margin-bottom: 0 !important;
        color: #111827 !important;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05) !important;
      }
      
      /* Input placeholder styling */
      form input::placeholder {
        color: #9ca3af !important;
        opacity: 1 !important;
        font-size: 0.9375rem !important;
      }
      
      /* Phone input wrapper - flex layout, perfectly aligned */
      form .phone-input-wrapper {
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
        width: 100% !important;
      }
      
      /* Country code selector container - keep relative positioning */
      form .country-code-selector {
        position: relative !important;
        display: inline-block !important;
        flex: 0 0 auto !important;
      }
      
      /* Country code button styling - modern design, narrower width */
      form .country-code-button,
      form .phone-input-wrapper .country-code-selector button {
        border: 1.5px solid #e5e7eb !important;
        border-radius: 0.5rem !important;
        padding: 0.75rem 0.5rem !important;
        font-size: 0.9375rem !important;
        height: 2.75rem !important;
        min-height: 2.75rem !important;
        max-height: 2.75rem !important;
        background: #ffffff !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        width: auto !important;
        min-width: 4rem !important;
        max-width: 4.5rem !important;
        flex: 0 0 auto !important;
        box-sizing: border-box !important;
        cursor: pointer !important;
        color: #111827 !important;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05) !important;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
        letter-spacing: -0.02em !important;
      }
      
      /* Reduce spacing in country code text content */
      form .country-code-button *,
      form .phone-input-wrapper .country-code-selector button * {
        letter-spacing: -0.02em !important;
      }
      
      form .country-code-button:hover,
      form .phone-input-wrapper .country-code-selector button:hover {
        border-color: #d1d5db !important;
        background: #f9fafb !important;
      }
      
      /* Phone number input - modern styling, same height as country code */
      form .phone-input-wrapper input,
      form input[name="phone"],
      form input[type="tel"] {
        flex: 1 !important;
        border: 1.5px solid #e5e7eb !important;
        border-radius: 0.5rem !important;
        padding: 0.75rem 1rem !important;
        font-size: 0.9375rem !important;
        width: auto !important;
        height: 2.75rem !important;
        min-height: 2.75rem !important;
        max-height: 2.75rem !important;
        box-sizing: border-box !important;
        color: #111827 !important;
        background: #ffffff !important;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05) !important;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
      }
      
      form .phone-input-wrapper input:hover,
      form input[name="phone"]:hover,
      form input[type="tel"]:hover {
        border-color: #d1d5db !important;
      }
      
      /* Focus states - modern ring effect */
      form input[type="text"]:not([name="phone"]):not(.country-code-search input):focus,
      form input[type="email"]:focus,
      form input[name="firstName"]:focus,
      form input[name="lastName"]:focus,
      form input[name="email"]:not([name="phone"]):focus,
      form input[name="phone"]:focus,
      form input[type="tel"]:focus,
      form select:focus,
      form button[data-slot="trigger"]:focus {
        outline: none !important;
        border-color: #3b82f6 !important;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.05) !important;
        background: #ffffff !important;
      }
      
      /* Hover states for inputs */
      form input[type="text"]:not([name="phone"]):not(.country-code-search input):hover,
      form input[type="email"]:hover,
      form input[name="firstName"]:hover,
      form input[name="lastName"]:hover,
      form input[name="email"]:not([name="phone"]):hover {
        border-color: #d1d5db !important;
      }
      
      /* AO Leader select/dropdown container - ensure relative positioning for dropdown */
      form [data-slot="mainWrapper"],
      form [data-slot="input-wrapper"],
      form > div:has(button[data-slot="trigger"]) {
        position: relative !important;
        background: transparent !important;
        border: none !important;
        box-shadow: none !important;
        padding: 0 !important;
        margin: 0 !important;
        display: flex !important;
        flex-direction: column !important;
        gap: 0.125rem !important;
        overflow: visible !important;
      }
      
      /* Ensure dropdown appears correctly */
      form #ao-leader-dropdown,
      form .ao-leader-dropdown-menu {
        position: absolute !important;
        top: 100% !important;
        left: 0 !important;
        width: 100% !important;
        z-index: 99999 !important;
        margin-top: -1px !important;
      }
      
      /* Label for AO Leader dropdown - positioned next to input, modern styling */
      form > div:has(button[data-slot="trigger"]) > label,
      form [data-slot="mainWrapper"] > label,
      form [data-slot="input-wrapper"] > label,
      form > div:has(button[data-slot="trigger"]) label:first-child,
      form label[for*="leader"],
      form label[for*="select"] {
        display: inline-block !important;
        font-size: 0.875rem !important;
        font-weight: 600 !important;
        color: #111827 !important;
        margin: 0 !important;
        padding: 0 !important;
        position: static !important;
        visibility: visible !important;
        opacity: 1 !important;
        white-space: nowrap !important;
        flex-shrink: 0 !important;
        line-height: 1.5 !important;
        letter-spacing: -0.01em !important;
      }
      
      /* Create label if it doesn't exist - using CSS pseudo-element */
      form > div:has(button[data-slot="trigger"]):not(:has(label))::before {
        content: "Select AO Leader *" !important;
        display: inline-block !important;
        font-size: 0.875rem !important;
        font-weight: 500 !important;
        color: #374151 !important;
        margin: 0 !important;
        white-space: nowrap !important;
        flex-shrink: 0 !important;
      }
      
      /* Hide the "Select AO Leader" label inside the button */
      form button[data-slot="trigger"] label[data-slot="label"],
      form button[aria-haspopup="listbox"]:not(.country-code-button) label[data-slot="label"],
      form button[data-slot="trigger"] label,
      form button[aria-haspopup="listbox"]:not(.country-code-button) label {
        display: none !important;
        visibility: hidden !important;
        height: 0 !important;
        width: 0 !important;
        margin: 0 !important;
        padding: 0 !important;
        opacity: 0 !important;
      }
      
      /* AO Leader select/dropdown button - modern design, wider to show full name */
      form button[data-slot="trigger"],
      form button[aria-haspopup="listbox"]:not(.country-code-button) {
        flex: 1 !important;
        width: auto !important;
        min-width: 12rem !important;
        height: auto !important;
        min-height: 2.75rem !important;
        max-height: 2.75rem !important;
        border: 1.5px solid #e5e7eb !important;
        border-radius: 0.5rem !important;
        padding: 0.75rem 1rem !important;
        padding-top: 0.75rem !important;
        padding-bottom: 0.75rem !important;
        font-size: 0.9375rem !important;
        text-align: left !important;
        background: #ffffff !important;
        position: relative !important;
        z-index: auto !important;
        margin: 0 !important;
        line-height: 1.5 !important;
        color: #111827 !important;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05) !important;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
        overflow: visible !important;
        white-space: nowrap !important;
        text-overflow: clip !important;
      }
      
      form button[data-slot="trigger"]:hover,
      form button[aria-haspopup="listbox"]:not(.country-code-button):hover {
        border-color: #d1d5db !important;
        background: #f9fafb !important;
      }
      
      /* Adjust inner wrapper padding when label is hidden */
      form button[data-slot="trigger"] [data-slot="innerWrapper"],
      form button[aria-haspopup="listbox"]:not(.country-code-button) [data-slot="innerWrapper"] {
        padding-top: 0 !important;
        height: auto !important;
        min-height: auto !important;
        overflow: visible !important;
        width: 100% !important;
      }
      
      /* Prevent text truncation in value span - show full name */
      form button[data-slot="trigger"] span[data-slot="value"],
      form button[aria-haspopup="listbox"]:not(.country-code-button) span[data-slot="value"] {
        white-space: nowrap !important;
        overflow: visible !important;
        text-overflow: clip !important;
        max-width: none !important;
        width: auto !important;
      }
      
      /* Hide "Choose one" text from being used as label - it should be inside button only */
      form button[data-slot="trigger"] span[data-slot="value"]:empty::before,
      form button[data-slot="trigger"] span[data-slot="value"]:contains("Choose one") {
        /* Keep the text inside button, but ensure label is separate */
      }
      
      /* Submit button styling - modern design */
      form button[type="submit"] {
        width: 100% !important;
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important;
        color: white !important;
        font-weight: 600 !important;
        font-size: 1rem !important;
        padding: 0.875rem 1.5rem !important;
        border-radius: 0.5rem !important;
        border: 0 !important;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1) !important;
        cursor: pointer !important;
        box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3), 0 2px 4px -1px rgba(59, 130, 246, 0.2) !important;
        margin-top: 1.5rem !important;
        letter-spacing: 0.01em !important;
      }
      
      form button[type="submit"]:hover {
        background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%) !important;
        box-shadow: 0 6px 8px -1px rgba(59, 130, 246, 0.4), 0 4px 6px -1px rgba(59, 130, 246, 0.3) !important;
        transform: translateY(-1px) !important;
      }
      
      form button[type="submit"]:active {
        transform: translateY(0) !important;
        box-shadow: 0 2px 4px -1px rgba(59, 130, 246, 0.3), 0 1px 2px -1px rgba(59, 130, 246, 0.2) !important;
      }
      
      /* Required field indicator */
      form .text-red-500 {
        color: #ef4444 !important;
      }
      
      /* Reduce gaps in flex/grid layouts */
      [class*="gap-"] {
        gap: 0.25rem !important;
      }
      
      [class*="space-"] {
        gap: 0.25rem !important;
      }
      
      /* Phone input wrapper gap */
      form .phone-input-wrapper {
        gap: 0.5rem !important;
      }
      
      /* Fix footer height on mobile - reduce blue footer area */
      footer,
      [class*="footer"],
      div:last-child,
      body > div:last-of-type {
        padding-top: 0.5rem !important;
        padding-bottom: 0.5rem !important;
        min-height: auto !important;
        height: auto !important;
        max-height: none !important;
      }
      
      /* Target any element with excessive padding that might be footer */
      div[style*="padding"]:last-child,
      div[style*="padding-top"]:last-child,
      div[style*="padding-bottom"]:last-child,
      div[style*="min-height"]:last-child {
        padding-top: 0.5rem !important;
        padding-bottom: 0.5rem !important;
        min-height: auto !important;
        height: auto !important;
        max-height: 200px !important;
      }
      
      /* Target elements with blue background at bottom */
      body > div:last-child,
      body > footer,
      div:last-child[style*="background"],
      div:last-child[style*="background-color"] {
        padding: 0.75rem !important;
        margin: 0 !important;
        min-height: auto !important;
        height: auto !important;
        max-height: 200px !important;
      }
      
      /* Ensure footer content fits and doesn't cause overflow */
      footer *,
      [class*="footer"] *,
      body > div:last-child *,
      div:last-child * {
        padding: 0.25rem !important;
        margin: 0.25rem 0 !important;
      }
      
      /* Remove any full-screen height on last divs */
      body > div:last-child {
        min-height: auto !important;
        height: auto !important;
        max-height: fit-content !important;
        padding-top: 0.75rem !important;
        padding-bottom: 0.75rem !important;
      }
      
      /* Ensure footer only takes space needed for content */
      body > div:last-child,
      footer,
      [class*="footer"] {
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
        justify-content: center !important;
      }
    }
  `;
  document.head.appendChild(style);
  
  // Function disabled - labels are now positioned above inputs via CSS, not floating inside
  function fixFormInputStructure() {
    // This function is disabled to prevent floating labels
    // Labels are now positioned above inputs using CSS (see CSS rules for .reg-form label)
    return;
    
    /* DISABLED CODE - keeping for reference
    const form = document.querySelector('.reg-form');
    if (!form) return;
    
    // Find all form inputs that need fixing - EXCLUDE phone inputs completely
    const inputsToFix = form.querySelectorAll('input[type="text"]:not([name="phone"]), input[type="email"], input[name="firstName"], input[name="lastName"], input[name="email"]');
    
    // Also exclude any inputs that are part of phone-input-wrapper or country-code structures
    const allInputs = Array.from(inputsToFix).filter(input => {
      // Skip phone inputs completely
      if (input.name === 'phone' || input.type === 'tel' || input.id === 'phone') {
        return false;
      }
      
      // Skip if part of phone-input-wrapper (even if not yet created, check parent classes)
      if (input.closest('.phone-input-wrapper') || 
          input.closest('.country-code-selector') ||
          input.closest('.country-code-dropdown')) {
        return false;
      }
      
      // Skip if already processed
      if (input.dataset.floatingLabelFixed) {
        return false;
      }
      
      // Skip inputs that are part of button/dropdown structures
      const parent = input.parentElement;
      if (parent && (
        parent.classList.contains('country-code-selector') ||
        parent.classList.contains('country-code-dropdown') ||
        parent.classList.contains('country-code-search') ||
        parent.querySelector('.country-code-button')
      )) {
        return false;
      }
      
      return true;
    });
    
    allInputs.forEach(input => {
      // Skip if already wrapped in relative div with label
      const parent = input.parentElement;
      if (parent.classList.contains('relative') && parent.querySelector('label')) {
        input.dataset.floatingLabelFixed = 'true';
        return;
      }
      
      // Get field name and determine label text
      let labelText = '';
      let fieldName = input.name || input.id || '';
      
      if (fieldName.includes('firstName') || fieldName.includes('first')) {
        labelText = 'First Name';
      } else if (fieldName.includes('lastName') || fieldName.includes('last')) {
        labelText = 'Last Name';
      } else if (fieldName.includes('email') || input.type === 'email') {
        labelText = 'E-Mail';
      } else {
        labelText = input.placeholder || 'Input';
      }
      
      // Check if required (has asterisk or required attribute)
      const closestDiv = input.closest('div');
      const isRequired = input.hasAttribute('required') || 
                        input.getAttribute('aria-required') === 'true' ||
                        (closestDiv && closestDiv.querySelector('.text-red-500, [class*="text-red"]'));
      
      // Create wrapper div if parent is not relative
      let wrapper = parent;
      if (!wrapper.classList.contains('relative')) {
        wrapper = document.createElement('div');
        wrapper.className = 'relative mb-4';
        input.parentNode.insertBefore(wrapper, input);
        wrapper.appendChild(input);
      } else {
        wrapper.classList.add('mb-4');
      }
      
      // Add peer class to input
      input.classList.add('peer');
      
      // Set placeholder to transparent if not already set
      if (!input.hasAttribute('placeholder') || input.placeholder === '') {
        input.setAttribute('placeholder', ' ');
      }
      
      // Ensure input has proper classes
      if (!input.classList.contains('w-full')) {
        input.classList.add('w-full');
      }
      if (!input.classList.contains('border')) {
        input.classList.add('border', 'border-gray-300', 'rounded-md', 'p-2');
      }
      input.classList.add('placeholder-transparent', 'focus:outline-none', 'focus:ring-2', 'focus:ring-blue-500');
      
      // Check if label already exists
      let label = wrapper.querySelector(`label[for="${input.id || input.name}"]`);
      if (!label && input.id) {
        label = document.querySelector(`label[for="${input.id}"]`);
        if (label && label.parentElement !== wrapper) {
          wrapper.appendChild(label);
        }
      }
      
      // Create label if it doesn't exist
      if (!label) {
        label = document.createElement('label');
        label.setAttribute('for', input.id || input.name || '');
        wrapper.appendChild(label);
      }
      
      // Set label classes and content - matching the exact pattern provided
      label.className = 'absolute left-3 top-2 text-gray-500 text-sm transition-all peer-placeholder-shown:top-2.5 peer-placeholder-shown:text-gray-400 peer-placeholder-shown:text-base peer-focus:top-0 peer-focus:text-sm peer-focus:text-blue-600 bg-white px-1';
      
      // Set label text - use exact format from pattern (text + space + asterisk span)
      // Pattern: "E-Mail <span class="text-red-500">*</span>"
      if (isRequired) {
        label.textContent = labelText + ' ';
        const asterisk = document.createElement('span');
        asterisk.className = 'text-red-500';
        asterisk.textContent = '*';
        label.appendChild(asterisk);
      } else {
        label.textContent = labelText;
      }
      
      // Update label position based on input value - CSS handles most of this via peer classes
      // But we need to ensure placeholder is set correctly for peer:placeholder-shown to work
      function updateLabelPosition() {
        // Ensure placeholder exists for peer:placeholder-shown to work
        if (!input.hasAttribute('placeholder') || input.placeholder === '') {
          input.setAttribute('placeholder', ' ');
        }
      }
      
      // Initialize label position
      updateLabelPosition();
      
      // Update on input events to ensure placeholder state is correct
      input.addEventListener('input', updateLabelPosition);
      input.addEventListener('focus', updateLabelPosition);
      input.addEventListener('blur', updateLabelPosition);
      
      // Mark as processed
      input.dataset.floatingLabelFixed = 'true';
    });
    */
  }
  
  // Initialize on page load and resize - delay to let phone wrapper initialize first
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(fixFormInputStructure, 500);
    });
  } else {
    setTimeout(fixFormInputStructure, 500);
  }
  
  // Re-run on window resize (for responsive changes) - but delay to avoid conflicts
  let formInputResizeTimeout;
  window.addEventListener('resize', () => {
    clearTimeout(formInputResizeTimeout);
    formInputResizeTimeout = setTimeout(fixFormInputStructure, 500);
  });
  
  // Watch for dynamically added form inputs - but be careful not to interfere with phone wrapper
  const formObserver = new MutationObserver((mutations) => {
    // Skip if mutation is from phone-input-wrapper creation
    let skipMutation = false;
    mutations.forEach(mutation => {
      mutation.addedNodes.forEach(node => {
        if (node.nodeType === 1 && (
          node.classList?.contains('phone-input-wrapper') ||
          node.classList?.contains('country-code-selector') ||
          node.classList?.contains('country-code-button')
        )) {
          skipMutation = true;
        }
      });
    });
    
    if (!skipMutation) {
      setTimeout(fixFormInputStructure, 100);
    }
  });
  
  const regForm = document.querySelector('.reg-form');
  if (regForm) {
    formObserver.observe(regForm, {
      childList: true,
      subtree: true
    });
  }
  
  // Function to move images to top on mobile
  function moveImagesToTop() {
    if (window.innerWidth <= 768) {
      // Find sidebar background div
      const sidebarBg = document.querySelector('div[class*="sidebar-bg"], div[class*="bg-\\[url"], div[class*="hidden"][class*="lg:block"], div[class*="w-1/3"][class*="bg-"]');
      
      if (sidebarBg) {
        // Move sidebar background to top
        const body = document.body;
        const firstChild = body.firstElementChild;
        
        if (firstChild !== sidebarBg) {
          body.insertBefore(sidebarBg, body.firstChild);
        }
        
        // Ensure it's visible and styled
        sidebarBg.style.display = 'block';
        sidebarBg.style.position = 'absolute';
        sidebarBg.style.top = '0';
        sidebarBg.style.left = '0';
        sidebarBg.style.right = '0';
        sidebarBg.style.width = '100%';
        sidebarBg.style.height = '150px';
        sidebarBg.style.zIndex = '0';
        sidebarBg.style.backgroundSize = 'cover';
        sidebarBg.style.backgroundPosition = 'center top';
        sidebarBg.style.backgroundRepeat = 'no-repeat';
      }
      
      // Fix footer height on mobile - find blue footer elements
      function fixFooterHeight() {
        const allDivs = document.querySelectorAll('div');
        const lastDiv = Array.from(document.body.children).pop();
        
        // Check if last div has blue background or excessive height
        if (lastDiv && window.innerWidth <= 768) {
          const computedStyle = window.getComputedStyle(lastDiv);
          const bgColor = computedStyle.backgroundColor;
          const height = computedStyle.height;
          const minHeight = computedStyle.minHeight;
          const paddingTop = parseFloat(computedStyle.paddingTop);
          const paddingBottom = parseFloat(computedStyle.paddingBottom);
          
          // Check if it's blue (RGB values for #0066cc are rgb(0, 102, 204))
          const isBlue = bgColor.includes('rgb(0, 102, 204)') || 
                        bgColor.includes('rgb(0, 102, 204)') ||
                        bgColor.toLowerCase().includes('#0066cc');
          
          // Check if it has excessive height or padding
          const hasExcessiveHeight = height && parseFloat(height) > 200;
          const hasExcessivePadding = paddingTop > 50 || paddingBottom > 50;
          
          if (isBlue || hasExcessiveHeight || hasExcessivePadding || minHeight && parseFloat(minHeight) > 200) {
            lastDiv.style.minHeight = 'auto';
            lastDiv.style.height = 'auto';
            lastDiv.style.maxHeight = 'fit-content';
            lastDiv.style.paddingTop = '0.75rem';
            lastDiv.style.paddingBottom = '0.75rem';
          }
        }
        
        // Also check footer elements
        const footers = document.querySelectorAll('footer, [class*="footer"]');
        footers.forEach(footer => {
          if (window.innerWidth <= 768) {
            footer.style.minHeight = 'auto';
            footer.style.height = 'auto';
            footer.style.maxHeight = 'fit-content';
            footer.style.paddingTop = '0.5rem';
            footer.style.paddingBottom = '0.5rem';
          }
        });
      }
      
      fixFooterHeight();
      
      // Also handle regular images
      const images = document.querySelectorAll('img');
      images.forEach(img => {
        // Ensure image is visible on mobile
        img.style.display = 'block';
        img.style.visibility = 'visible';
        img.style.opacity = '1';
        
        // Check if image is not already at the top
        const body = document.body;
        const firstChild = body.firstElementChild;
        
        // If image is not the first element, move it
        if (firstChild !== img && img.parentElement === body) {
          // Don't move if sidebar bg is first
          const sidebarBg = document.querySelector('div[class*="sidebar-bg"], div[class*="bg-\\[url"], div[class*="w-1/3"][class*="bg-"]');
          if (sidebarBg && body.firstElementChild === sidebarBg) {
            body.insertBefore(img, sidebarBg.nextSibling);
          } else {
            body.insertBefore(img, body.firstChild);
          }
        } else if (img.parentElement !== body) {
          // If image is in a container, move the container to top
          const container = img.closest('div, section, article, picture');
          if (container && container.parentElement === body) {
            // Make sure container is visible
            container.style.display = 'block';
            container.style.visibility = 'visible';
            container.style.opacity = '1';
            
            const sidebarBg = document.querySelector('div[class*="sidebar-bg"], div[class*="bg-\\[url"], div[class*="w-1/3"][class*="bg-"]');
            if (sidebarBg && body.firstElementChild === sidebarBg) {
              body.insertBefore(container, sidebarBg.nextSibling);
            } else if (container !== body.firstElementChild) {
              body.insertBefore(container, body.firstChild);
            }
          }
        }
      });
    }
  }
  
  // Run on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(moveImagesToTop, 100);
    });
  } else {
    setTimeout(moveImagesToTop, 100);
  }
  
  // Run on resize
  let imageResizeTimeout;
  window.addEventListener('resize', () => {
    clearTimeout(imageResizeTimeout);
    imageResizeTimeout = setTimeout(moveImagesToTop, 100);
  });
  
  // Watch for dynamically added images
  const imageObserver = new MutationObserver(() => {
    moveImagesToTop();
  });
  
  imageObserver.observe(document.body, {
    childList: true,
    subtree: true
  });
  
  // Global handlers for country code dropdown (defined once)
  function handleCountryCodeDocumentClick(e) {
    const target = e.target;
    
    // FIRST: Check if clicking on leader button - if so, don't interfere at all
    const form = document.querySelector('.reg-form');
    let isLeaderElement = false;
    
    if (form) {
      const leaderButton = form.querySelector('button[data-slot="trigger"]:not(.country-code-button)') ||
                         form.querySelector('button[aria-haspopup="listbox"]:not(.country-code-button)');
      const leaderDropdown = form.querySelector('[role="listbox"]:not(.country-code-dropdown)');
      
      // Check if click is on leader elements (including children) - check this FIRST
      const clickedOnLeaderButton = leaderButton && (
        leaderButton === target || 
        leaderButton.contains(target) ||
        (target.closest && target.closest('button[data-slot="trigger"]:not(.country-code-button)'))
      );
      
      const clickedOnLeaderDropdown = leaderDropdown && (
        leaderDropdown === target ||
        leaderDropdown.contains(target) ||
        (target.closest && target.closest('[role="listbox"]:not(.country-code-dropdown)'))
      );
      
      isLeaderElement = clickedOnLeaderButton || clickedOnLeaderDropdown;
    }
    
    // If clicking on leader elements, don't do anything - let leader handlers work
    if (isLeaderElement) {
      return;
    }
    
    // Now check for open country code dropdowns
    const openDropdowns = document.querySelectorAll('.country-code-dropdown.open');
    
    if (openDropdowns.length === 0) return;
    
    // Only close country code dropdowns if clicking outside them
    openDropdowns.forEach(openDropdown => {
      const dropdownSelector = openDropdown.closest('.country-code-selector');
      // Close if click is outside this dropdown
      if (!dropdownSelector || !dropdownSelector.contains(target)) {
        const button = dropdownSelector?.querySelector('.country-code-button');
        const searchInput = openDropdown.querySelector('.country-code-search input');
        if (button && openDropdown) {
          openDropdown.classList.remove('open');
          button.classList.remove('open');
          button.setAttribute('aria-expanded', 'false');
          if (searchInput) {
            searchInput.value = '';
          }
          // Reset filter
          const optionsContainer = openDropdown.querySelector('.country-code-options-container');
          if (optionsContainer) {
            const options = optionsContainer.querySelectorAll('.country-code-option');
            options.forEach(option => option.classList.remove('hidden'));
          }
        }
      }
    });
  }
  
  function handleCountryCodeEscapeKey(e) {
    const openDropdowns = document.querySelectorAll('.country-code-dropdown.open');
    if (openDropdowns.length > 0 && e.key === 'Escape') {
      // Close the first open dropdown
      const firstOpen = openDropdowns[0];
      const dropdownSelector = firstOpen.closest('.country-code-selector');
      const button = dropdownSelector?.querySelector('.country-code-button');
      const searchInput = firstOpen.querySelector('.country-code-search input');
      
      if (button && firstOpen) {
        firstOpen.classList.remove('open');
        button.classList.remove('open');
        button.setAttribute('aria-expanded', 'false');
        if (searchInput) {
          searchInput.value = '';
        }
        // Reset filter
        const optionsContainer = firstOpen.querySelector('.country-code-options-container');
        if (optionsContainer) {
          const options = optionsContainer.querySelectorAll('.country-code-option');
          options.forEach(option => option.classList.remove('hidden'));
        }
        button.focus();
      }
    }
  }
  
  // Initialize country code selector
  function initCountryCodeSelector() {
    const form = document.querySelector('.reg-form');
    if (!form) return;
    
    const phoneInput = form.querySelector('input[name="phone"]') || 
                      form.querySelector('input[type="tel"]');
    
    if (!phoneInput) return;
    
    // Check if already wrapped
    if (phoneInput.parentElement.classList.contains('phone-input-wrapper')) {
      return;
    }
    
    // Create wrapper
    const wrapper = document.createElement('div');
    wrapper.className = 'phone-input-wrapper';
    
    // Create country code selector
    const selector = document.createElement('div');
    selector.className = 'country-code-selector';
    
    const button = document.createElement('button');
    button.type = 'button';
    button.className = 'country-code-button';
    button.setAttribute('aria-haspopup', 'listbox');
    button.setAttribute('aria-expanded', 'false');
    
    const flagSpan = document.createElement('span');
    flagSpan.className = 'flag';
    flagSpan.textContent = countryCodes[0].flag;
    
    const dialCodeSpan = document.createElement('span');
    dialCodeSpan.className = 'dial-code';
    dialCodeSpan.textContent = countryCodes[0].dialCode;
    
    const arrowSpan = document.createElement('span');
    arrowSpan.className = 'arrow';
    arrowSpan.innerHTML = 'â–¼';
    
    button.appendChild(flagSpan);
    button.appendChild(dialCodeSpan);
    button.appendChild(arrowSpan);
    
    // Create dropdown
    const dropdown = document.createElement('div');
    dropdown.className = 'country-code-dropdown';
    dropdown.setAttribute('role', 'listbox');
    
    // Create search box
    const searchContainer = document.createElement('div');
    searchContainer.className = 'country-code-search';
    const searchInput = document.createElement('input');
    searchInput.type = 'text';
    searchInput.placeholder = 'Search countries...';
    searchContainer.appendChild(searchInput);
    dropdown.appendChild(searchContainer);
    
    // Create options container
    const optionsContainer = document.createElement('div');
    optionsContainer.className = 'country-code-options-container';
    dropdown.appendChild(optionsContainer);
    
    countryCodes.forEach((country, index) => {
      const option = document.createElement('div');
      option.className = 'country-code-option';
      option.setAttribute('role', 'option');
      option.setAttribute('data-code', country.dialCode);
      option.setAttribute('data-flag', country.flag);
      option.setAttribute('data-name', country.name.toLowerCase());
      option.setAttribute('data-dialcode', country.dialCode);
      
      const flag = document.createElement('span');
      flag.className = 'flag';
      flag.textContent = country.flag;
      
      const dialCode = document.createElement('span');
      dialCode.className = 'dial-code';
      dialCode.textContent = country.dialCode;
      
      const name = document.createElement('span');
      name.className = 'country-name';
      name.textContent = country.name;
      
      option.appendChild(flag);
      option.appendChild(dialCode);
      option.appendChild(name);
      
      option.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        flagSpan.textContent = country.flag;
        dialCodeSpan.textContent = country.dialCode;
        button.setAttribute('data-selected-code', country.dialCode);
        dropdown.classList.remove('open');
        button.classList.remove('open');
        button.setAttribute('aria-expanded', 'false');
        searchInput.value = '';
        filterOptions('');
        phoneInput.focus();
      });
      
      optionsContainer.appendChild(option);
    });
    
    // Filter function
    function filterOptions(searchTerm) {
      const options = optionsContainer.querySelectorAll('.country-code-option');
      const term = searchTerm.toLowerCase().trim();
      
      options.forEach(option => {
        const name = option.getAttribute('data-name');
        const dialCode = option.getAttribute('data-dialcode');
        
        if (term === '' || name.includes(term) || dialCode.includes(term)) {
          option.classList.remove('hidden');
        } else {
          option.classList.add('hidden');
        }
      });
    }
    
    // Search input handler
    searchInput.addEventListener('input', (e) => {
      filterOptions(e.target.value);
    });
    
    searchInput.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        dropdown.classList.remove('open');
        button.classList.remove('open');
        button.setAttribute('aria-expanded', 'false');
        searchInput.value = '';
        filterOptions('');
        button.focus();
      }
    });
    
    selector.appendChild(button);
    selector.appendChild(dropdown);
    
    // Prevent clicks inside dropdown from propagating
    dropdown.addEventListener('click', (e) => {
      e.stopPropagation();
    });
    
    // Also prevent search input clicks from propagating
    searchInput.addEventListener('click', (e) => {
      e.stopPropagation();
    });
    
    // Wrap phone input
    phoneInput.parentNode.insertBefore(wrapper, phoneInput);
    wrapper.appendChild(selector);
    wrapper.appendChild(phoneInput);
    
    // Set default country code
    button.setAttribute('data-selected-code', countryCodes[0].dialCode);
    
    // Close dropdown function
    function closeCountryCodeDropdown() {
      dropdown.classList.remove('open');
      button.classList.remove('open');
      button.setAttribute('aria-expanded', 'false');
      searchInput.value = '';
      filterOptions('');
    }
    
    // Function to constrain dropdown height to prevent footer overlap
    function constrainDropdownHeight() {
      const buttonRect = button.getBoundingClientRect();
      const buttonBottom = buttonRect.bottom;
      
      // Find the footer - check multiple selectors and computed styles
      const footerSelectors = [
        'footer',
        '[class*="footer"]',
        'body > div:last-child'
      ];
      
      let minFooterTop = window.innerHeight;
      
      footerSelectors.forEach(selector => {
        try {
          const elements = document.querySelectorAll(selector);
          elements.forEach(el => {
            const rect = el.getBoundingClientRect();
            // Only consider elements that are below the button and visible
            if (rect.top > buttonBottom && rect.top < minFooterTop && rect.height > 0) {
              // Check if it looks like a footer (has blue background or is at bottom)
              const style = window.getComputedStyle(el);
              const bgColor = style.backgroundColor;
              const isNearBottom = rect.bottom >= window.innerHeight - 50;
              
              // Check for blue-ish backgrounds (rgb values)
              const isBlueBackground = bgColor.includes('rgb') && (
                bgColor.includes('0, 0') || // Dark blue/black
                bgColor.includes('13, 110') || // Blue shades
                bgColor.includes('29, 78') || // Blue shades
                bgColor.includes('37, 99') // Blue shades
              );
              
              if (isNearBottom || isBlueBackground || selector === 'body > div:last-child') {
                minFooterTop = Math.min(minFooterTop, rect.top);
              }
            }
          });
        } catch(e) {}
      });
      
      // Also check all divs at the bottom of the page
      const allDivs = document.querySelectorAll('body > div');
      if (allDivs.length > 0) {
        const lastDiv = allDivs[allDivs.length - 1];
        const rect = lastDiv.getBoundingClientRect();
        if (rect.top > buttonBottom && rect.top < minFooterTop) {
          minFooterTop = rect.top;
        }
      }
      
      // Calculate available space (with padding)
      const availableSpace = minFooterTop - buttonBottom - 30;
      
      // Set max height (minimum 150px, maximum 300px)
      const maxHeight = Math.max(150, Math.min(300, availableSpace));
      
      // Apply to dropdown
      dropdown.style.setProperty('max-height', maxHeight + 'px', 'important');
      
      // Apply to options container (account for search box ~60px)
      const optionsMaxHeight = Math.max(100, maxHeight - 60);
      optionsContainer.style.setProperty('max-height', optionsMaxHeight + 'px', 'important');
    }
    
    // Toggle dropdown
    button.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation(); // Prevent document handler from interfering
      const isOpen = dropdown.classList.contains('open');
      
      if (isOpen) {
        closeCountryCodeDropdown();
      } else {
        // Constrain height before opening
        constrainDropdownHeight();
        dropdown.classList.add('open');
        button.classList.add('open');
        button.setAttribute('aria-expanded', 'true');
        // Re-constrain after a brief delay to ensure layout is complete
        setTimeout(() => {
          constrainDropdownHeight();
          searchInput.focus();
        }, 50);
      }
    });
    
    // Store reference to this dropdown
    selector.dataset.countryCodeDropdown = 'true';
    
    // Use global handlers (only add listeners once)
    if (!window.countryCodeClickHandlerAdded) {
      document.addEventListener('click', handleCountryCodeDocumentClick, false);
      window.countryCodeClickHandlerAdded = true;
    }
    
    if (!window.countryCodeEscapeHandlerAdded) {
      document.addEventListener('keydown', handleCountryCodeEscapeKey);
      window.countryCodeEscapeHandlerAdded = true;
    }
    
    // Add resize/scroll handler to recalculate dropdown height when open
    if (!window.countryCodeResizeHandlerAdded) {
      let resizeTimeout;
      function recalculateOpenDropdowns() {
        const openDropdowns = document.querySelectorAll('.country-code-dropdown.open');
        if (openDropdowns.length === 0) return;
        
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
          openDropdowns.forEach(openDropdown => {
            const selector = openDropdown.closest('.country-code-selector');
            const btn = selector?.querySelector('.country-code-button');
            if (!btn) return;
            
            const buttonRect = btn.getBoundingClientRect();
            const buttonBottom = buttonRect.bottom;
            
            const footerSelectors = [
              'footer',
              '[class*="footer"]',
              'body > div:last-child'
            ];
            
            let minFooterTop = window.innerHeight;
            
            footerSelectors.forEach(sel => {
              try {
                document.querySelectorAll(sel).forEach(el => {
                  const rect = el.getBoundingClientRect();
                  if (rect.top > buttonBottom && rect.top < minFooterTop && rect.height > 0) {
                    const style = window.getComputedStyle(el);
                    const bgColor = style.backgroundColor;
                    const isNearBottom = rect.bottom >= window.innerHeight - 50;
                    
                    const isBlueBackground = bgColor.includes('rgb') && (
                      bgColor.includes('0, 0') ||
                      bgColor.includes('13, 110') ||
                      bgColor.includes('29, 78') ||
                      bgColor.includes('37, 99')
                    );
                    
                    if (isNearBottom || isBlueBackground || sel === 'body > div:last-child') {
                      minFooterTop = Math.min(minFooterTop, rect.top);
                    }
                  }
                });
              } catch(e) {}
            });
            
            // Also check last div
            const allDivs = document.querySelectorAll('body > div');
            if (allDivs.length > 0) {
              const lastDiv = allDivs[allDivs.length - 1];
              const rect = lastDiv.getBoundingClientRect();
              if (rect.top > buttonBottom && rect.top < minFooterTop) {
                minFooterTop = rect.top;
              }
            }
            
            const availableSpace = minFooterTop - buttonBottom - 30;
            const maxHeight = Math.max(150, Math.min(300, availableSpace));
            
            openDropdown.style.setProperty('max-height', maxHeight + 'px', 'important');
            
            const optionsContainer = openDropdown.querySelector('.country-code-options-container');
            if (optionsContainer) {
              const optionsMaxHeight = Math.max(100, maxHeight - 60);
              optionsContainer.style.setProperty('max-height', optionsMaxHeight + 'px', 'important');
            }
          });
        }, 50);
      }
      
      window.addEventListener('resize', recalculateOpenDropdowns);
      window.addEventListener('scroll', recalculateOpenDropdowns, true);
      window.countryCodeResizeHandlerAdded = true;
    }
  }
  
  // Initialize on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCountryCodeSelector);
  } else {
    initCountryCodeSelector();
  }
  
  // Also try after a delay to catch dynamically loaded forms
  setTimeout(initCountryCodeSelector, 500);
  
  // Watch for form changes
  const observer = new MutationObserver(() => {
    initCountryCodeSelector();
  });
  
  observer.observe(document.body, {
    childList: true,
    subtree: true
  });
  
  // ============================================
  // LANGUAGE SELECTOR
  // ============================================
  
  // Language data
  const languages = [
    { code: 'en', name: 'English', flag: 'ðŸ‡¬ðŸ‡§' },
    { code: 'de', name: 'German', flag: 'ðŸ‡©ðŸ‡ª' },
    { code: 'nl', name: 'Dutch', flag: 'ðŸ‡³ðŸ‡±' }
  ];
  
  // Add CSS for language selector
  const languageStyle = document.createElement('style');
  languageStyle.textContent = `
    .language-selector-wrapper {
      position: relative;
      display: none !important; /* Hidden from form - footer links still work */
      width: 100%;
    }
    
    .language-selector-button {
      display: none !important; /* Hidden from form - footer links still work */
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: #f3f4f6;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: #374151;
      transition: all 0.2s;
      user-select: none;
      width: 100%;
      justify-content: space-between;
    }
    
    .language-selector-button:hover {
      background: #e5e7eb;
      border-color: #9ca3af;
    }
    
    .language-selector-button:focus {
      outline: 2px solid #3b82f6;
      outline-offset: -2px;
    }
    
    .language-selector-button .flag {
      font-size: 18px;
      line-height: 1;
    }
    
    .language-selector-button .language-name {
      flex: 1;
      text-align: left;
    }
    
    .language-selector-button .arrow {
      font-size: 10px;
      transition: transform 0.2s;
      color: #6b7280;
    }
    
    .language-selector-button.open .arrow {
      transform: rotate(180deg);
    }
    
    .language-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      margin-top: 4px;
      background: white;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      max-height: 200px;
      overflow-y: auto;
      z-index: 1000;
      display: none;
    }
    
    .language-dropdown.open {
      display: block;
    }
    
    .language-option {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      cursor: pointer;
      transition: background 0.15s;
      font-size: 14px;
    }
    
    .language-option:hover {
      background: #f3f4f6;
    }
    
    .language-option .flag {
      font-size: 20px;
      line-height: 1;
    }
    
    .language-option .language-name {
      color: #374151;
      flex: 1;
    }
  `;
  document.head.appendChild(languageStyle);
  
  // Initialize language selector
  function initLanguageSelector() {
    const form = document.querySelector('.reg-form');
    if (!form) return;
    
    // Check if language selector already exists
    if (form.querySelector('.language-selector-wrapper')) {
      return;
    }
    
    // Create language selector
    const wrapper = document.createElement('div');
    wrapper.className = 'language-selector-wrapper';
    
    const button = document.createElement('button');
    button.type = 'button';
    button.className = 'language-selector-button';
    button.setAttribute('aria-haspopup', 'listbox');
    button.setAttribute('aria-expanded', 'false');
    button.setAttribute('data-selected-language', languages[0].code);
    
    const flagSpan = document.createElement('span');
    flagSpan.className = 'flag';
    flagSpan.textContent = languages[0].flag;
    
    const nameSpan = document.createElement('span');
    nameSpan.className = 'language-name';
    nameSpan.textContent = languages[0].name;
    
    const arrowSpan = document.createElement('span');
    arrowSpan.className = 'arrow';
    arrowSpan.innerHTML = 'â–¼';
    
    button.appendChild(flagSpan);
    button.appendChild(nameSpan);
    button.appendChild(arrowSpan);
    
    // Create dropdown
    const dropdown = document.createElement('div');
    dropdown.className = 'language-dropdown';
    dropdown.setAttribute('role', 'listbox');
    
    languages.forEach((language) => {
      const option = document.createElement('div');
      option.className = 'language-option';
      option.setAttribute('role', 'option');
      option.setAttribute('data-code', language.code);
      
      const flag = document.createElement('span');
      flag.className = 'flag';
      flag.textContent = language.flag;
      
      const name = document.createElement('span');
      name.className = 'language-name';
      name.textContent = language.name;
      
      option.appendChild(flag);
      option.appendChild(name);
      
      option.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        flagSpan.textContent = language.flag;
        nameSpan.textContent = language.name;
        button.setAttribute('data-selected-language', language.code);
        dropdown.classList.remove('open');
        button.classList.remove('open');
        button.setAttribute('aria-expanded', 'false');
        
        // Update current language and apply translations
        currentLanguage = language.code;
        applyTranslations(language.code);
      });
      
      dropdown.appendChild(option);
    });
    
    wrapper.appendChild(button);
    wrapper.appendChild(dropdown);
    
    // Insert language selector into form (before submit button or at the end)
    const submitButton = form.querySelector('button[type="submit"]') || form.querySelector('input[type="submit"]');
    if (submitButton) {
      form.insertBefore(wrapper, submitButton);
    } else {
      form.appendChild(wrapper);
    }
    
    // Toggle dropdown
    button.addEventListener('click', (e) => {
      e.preventDefault();
      e.stopPropagation();
      const isOpen = dropdown.classList.contains('open');
      
      if (isOpen) {
        dropdown.classList.remove('open');
        button.classList.remove('open');
        button.setAttribute('aria-expanded', 'false');
      } else {
        dropdown.classList.add('open');
        button.classList.add('open');
        button.setAttribute('aria-expanded', 'true');
      }
    });
    
    // Close dropdown when clicking outside
    function handleLanguageClickOutside(e) {
      if (!wrapper.contains(e.target)) {
        dropdown.classList.remove('open');
        button.classList.remove('open');
        button.setAttribute('aria-expanded', 'false');
      }
    }
    
    document.addEventListener('click', handleLanguageClickOutside);
    
    // Close dropdown on escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && dropdown.classList.contains('open')) {
        dropdown.classList.remove('open');
        button.classList.remove('open');
        button.setAttribute('aria-expanded', 'false');
        button.focus();
      }
    });
  }
  
  // Initialize language selector
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initLanguageSelector);
  } else {
    initLanguageSelector();
  }
  
  setTimeout(initLanguageSelector, 500);
  
  // Watch for form changes
  const languageObserver = new MutationObserver(() => {
    initLanguageSelector();
  });
  
  languageObserver.observe(document.body, {
    childList: true,
    subtree: true
  });
  
  // ============================================
  // LANGUAGE LINK TRANSLATIONS
  // ============================================
  
  // Language translation map
  const translations = {
    en: {
      // Form fields
      'firstName': 'First Name',
      'lastName': 'Last Name',
      'email': 'Email',
      'phone': 'Phone',
      'selectLeader': 'Select Leader',
      'submit': 'Submit',
      'chooseOne': 'Choose one',
      // Common UI elements
      'pleaseFillAll': 'Please fill in all required fields including selecting an AO Leader.',
      'registrationFailed': 'Registration failed:',
      'errorOccurred': 'An error occurred while submitting the form. Please try again.',
      'registrationSuccessful': 'Registration successful!'
    },
    de: {
      // Form fields
      'firstName': 'Vorname',
      'lastName': 'Nachname',
      'email': 'E-Mail',
      'phone': 'Telefon',
      'selectLeader': 'FÃ¼hrer auswÃ¤hlen',
      'submit': 'Einreichen',
      'chooseOne': 'WÃ¤hlen Sie einen aus',
      // Common UI elements
      'pleaseFillAll': 'Bitte fÃ¼llen Sie alle erforderlichen Felder aus, einschlieÃŸlich der Auswahl eines AO-FÃ¼hrers.',
      'registrationFailed': 'Registrierung fehlgeschlagen:',
      'errorOccurred': 'Beim Senden des Formulars ist ein Fehler aufgetreten. Bitte versuchen Sie es erneut.',
      'registrationSuccessful': 'Registrierung erfolgreich!'
    },
    nl: {
      // Form fields
      'firstName': 'Voornaam',
      'lastName': 'Achternaam',
      'email': 'E-mail',
      'phone': 'Telefoon',
      'selectLeader': 'Leider selecteren',
      'submit': 'Verzenden',
      'chooseOne': 'Kies er een',
      // Common UI elements
      'pleaseFillAll': 'Vul alle verplichte velden in, inclusief het selecteren van een AO-leider.',
      'registrationFailed': 'Registratie mislukt:',
      'errorOccurred': 'Er is een fout opgetreden bij het verzenden van het formulier. Probeer het opnieuw.',
      'registrationSuccessful': 'Registratie succesvol!'
    }
  };
  
  // Store original text content for elements
  const originalTexts = new Map();
  
  // Function to store original text
  function storeOriginalText(element, key) {
    if (!originalTexts.has(key)) {
      originalTexts.set(key, element.textContent || element.value || element.placeholder || '');
    }
  }
  
  // Function to get translation key from text
  function getTranslationKey(text) {
    if (!text) return null;
    const normalizedText = text.trim().toLowerCase();
    
    // Map common English text to translation keys
    const textToKey = {
      'first name': 'firstName',
      'last name': 'lastName',
      'email': 'email',
      'phone': 'phone',
      'select leader': 'selectLeader',
      'choose one': 'chooseOne',
      'submit': 'submit',
      'please fill in all required fields including selecting an ao leader.': 'pleaseFillAll',
      'registration failed:': 'registrationFailed',
      'an error occurred while submitting the form. please try again.': 'errorOccurred',
      'registration successful!': 'registrationSuccessful'
    };
    
    return textToKey[normalizedText] || null;
  }
  
  // Current language
  let currentLanguage = 'en';
  
  // Function to update language links
  function updateLanguageLinks() {
    // Find all links and check for language links
    const allLinks = document.querySelectorAll('a');
    
    allLinks.forEach(link => {
      const linkText = link.textContent.trim();
      const linkHref = link.getAttribute('href');
      const linkClass = link.getAttribute('class') || '';
      
      // Check if it's a language link by:
      // 1. Text content matches English/German/Dutch
      // 2. Has the specific color class or links to ao-recruiting.agency
      const isLanguageLink = (linkText === 'English' || linkText === 'German' || linkText === 'Dutch') &&
                             (linkClass.includes('869AB8') || linkClass.includes('text-[') || 
                              (linkHref && linkHref.includes('ao-recruiting.agency')));
      
      if (isLanguageLink) {
        // Skip if already processed
        if (link.dataset.languageLinkProcessed) {
          return;
        }
        
        // Mark as processed
        link.dataset.languageLinkProcessed = 'true';
        
        // Remove href redirect completely
        link.removeAttribute('href');
        link.style.cursor = 'pointer';
        
        // Add click handler for translation
        link.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          
          let langCode = 'en';
          if (linkText === 'German') langCode = 'de';
          else if (linkText === 'Dutch') langCode = 'nl';
          
          // Update language selector if it exists
          const languageButton = document.querySelector('.language-selector-button[data-selected-language]');
          if (languageButton) {
            languageButton.setAttribute('data-selected-language', langCode);
            const languageName = languageButton.querySelector('.language-name');
            const languageFlag = languageButton.querySelector('.flag');
            
            if (languageName && languageFlag) {
              const selectedLang = languages.find(l => l.code === langCode);
              if (selectedLang) {
                languageName.textContent = selectedLang.name;
                languageFlag.textContent = selectedLang.flag;
              }
            }
          }
          
          // Update current language
          currentLanguage = langCode;
          
          // Apply translations
          applyTranslations(langCode);
        });
      }
    });
  }
  
  // Function to apply translations to entire page
  function applyTranslations(langCode) {
    const lang = translations[langCode] || translations.en;
    
    // Update form input placeholders
    const firstNameInput = document.querySelector('input[name="firstName"]');
    const lastNameInput = document.querySelector('input[name="lastName"]');
    const emailInput = document.querySelector('input[name="email"]');
    const phoneInput = document.querySelector('input[name="phone"]');
    
    if (firstNameInput) {
      const originalPlaceholder = originalTexts.get('firstNamePlaceholder') || firstNameInput.placeholder || 'First Name';
      if (!originalTexts.has('firstNamePlaceholder')) {
        originalTexts.set('firstNamePlaceholder', originalPlaceholder);
      }
      firstNameInput.placeholder = lang.firstName;
    }
    
    if (lastNameInput) {
      const originalPlaceholder = originalTexts.get('lastNamePlaceholder') || lastNameInput.placeholder || 'Last Name';
      if (!originalTexts.has('lastNamePlaceholder')) {
        originalTexts.set('lastNamePlaceholder', originalPlaceholder);
      }
      lastNameInput.placeholder = lang.lastName;
    }
    
    if (emailInput) {
      const originalPlaceholder = originalTexts.get('emailPlaceholder') || emailInput.placeholder || 'Email';
      if (!originalTexts.has('emailPlaceholder')) {
        originalTexts.set('emailPlaceholder', originalPlaceholder);
      }
      emailInput.placeholder = lang.email;
    }
    
    if (phoneInput) {
      const originalPlaceholder = originalTexts.get('phonePlaceholder') || phoneInput.placeholder || 'Phone';
      if (!originalTexts.has('phonePlaceholder')) {
        originalTexts.set('phonePlaceholder', originalPlaceholder);
      }
      phoneInput.placeholder = lang.phone;
    }
    
    // Translate buttons
    const buttons = document.querySelectorAll('button, input[type="submit"]');
    buttons.forEach(button => {
      const buttonText = button.textContent.trim() || button.value;
      if (buttonText) {
        const key = getTranslationKey(buttonText);
        if (key && lang[key]) {
          if (button.tagName === 'INPUT') {
            button.value = lang[key];
          } else {
            button.textContent = lang[key];
          }
        }
      }
    });
    
    // Translate leader dropdown button
    const leaderButton = document.querySelector('button[data-slot="trigger"]') ||
                        document.querySelector('button[aria-haspopup="listbox"]:not(.country-code-button)');
    if (leaderButton) {
      const valueSpan = leaderButton.querySelector('span[data-slot="value"]') ||
                       leaderButton.querySelector('span#react-aria-\\:R25icv6jaH7\\:');
      if (valueSpan) {
        const currentText = valueSpan.textContent.trim();
        if (currentText === 'Choose one' || currentText.toLowerCase().includes('choose')) {
          valueSpan.textContent = lang.chooseOne;
        }
      }
    }
    
    // Translate labels
    const labels = document.querySelectorAll('label');
    labels.forEach(label => {
      const labelText = label.textContent.trim();
      if (labelText) {
        const key = getTranslationKey(labelText);
        if (key && lang[key]) {
          label.textContent = lang[key];
        }
      }
    });
    
    // Translate headings
    const headings = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
    headings.forEach(heading => {
      const headingText = heading.textContent.trim();
      if (headingText) {
        const key = getTranslationKey(headingText);
        if (key && lang[key]) {
          heading.textContent = lang[key];
        }
      }
    });
    
    // Translate paragraphs and spans (common text elements)
    const textElements = document.querySelectorAll('p, span, div');
    textElements.forEach(element => {
      // Skip if it's a script or style element
      if (element.tagName === 'SCRIPT' || element.tagName === 'STYLE') return;
      
      // Skip if it contains other elements (only translate leaf nodes)
      if (element.children.length > 0 && element.textContent.trim() === element.innerText.trim()) {
        const text = element.textContent.trim();
        if (text) {
          const key = getTranslationKey(text);
          if (key && lang[key]) {
            element.textContent = lang[key];
          }
        }
      }
    });
    
    // Update page language attribute
    document.documentElement.lang = langCode;
    
    console.log('Page translated to:', langCode);
  }
  
  // Function to scan and mark translatable elements on page load
  function scanPageForTranslations() {
    // Store original English text for all translatable elements
    const elementsToTranslate = document.querySelectorAll('button, input[type="submit"], label, h1, h2, h3, h4, h5, h6, p, span');
    
    elementsToTranslate.forEach(element => {
      const text = element.textContent.trim() || element.value || element.placeholder;
      if (text) {
        const key = getTranslationKey(text);
        if (key) {
          const elementId = element.id || `elem-${Date.now()}-${Math.random()}`;
          if (!element.id) element.id = elementId;
          originalTexts.set(elementId, text);
        }
      }
    });
  }
  
  // Scan page when loaded
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(scanPageForTranslations, 500);
    });
  } else {
    setTimeout(scanPageForTranslations, 500);
  }
  
  // Initialize language links
  function initLanguageLinks() {
    updateLanguageLinks();
  }
  
  // Run on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initLanguageLinks);
  } else {
    initLanguageLinks();
  }
  
  // Watch for dynamically added links
  const linkObserver = new MutationObserver(() => {
    updateLanguageLinks();
  });
  
  linkObserver.observe(document.body, {
    childList: true,
    subtree: true
  });
  
  // ============================================
  // FORM SUBMISSION HANDLER
  // ============================================
  
  // Form submission handler
  const submitForm = document.querySelector('.reg-form');
  if (submitForm) {
    submitForm.setAttribute('novalidate', 'novalidate');
    
    submitForm.addEventListener('submit', async function(e) {
      e.preventDefault();
      e.stopPropagation();
      
      console.log('=== FORM SUBMISSION STARTED ===');
      
      const data = {};
      
      // Get all input fields directly
      const firstNameInput = submitForm.querySelector('input[name="firstName"]') || 
                             Array.from(submitForm.querySelectorAll('input[type="text"]'))[0];
      const lastNameInput = submitForm.querySelector('input[name="lastName"]');
      const emailInput = submitForm.querySelector('input[name="email"]') || 
                         submitForm.querySelector('input[type="email"]');
      const phoneInput = submitForm.querySelector('input[name="phone"]') || 
                        submitForm.querySelector('input[type="tel"]');
      
      // Get country code from button
      let countryCode = '+1'; // default
      const countryCodeButton = submitForm.querySelector('.country-code-button[data-selected-code]');
      if (countryCodeButton) {
        countryCode = countryCodeButton.getAttribute('data-selected-code') || '+1';
      }
      
      // Get language from language selector button
      let language = 'en'; // default
      const languageButton = submitForm.querySelector('.language-selector-button[data-selected-language]');
      if (languageButton) {
        language = languageButton.getAttribute('data-selected-language') || 'en';
      }
      
      if (firstNameInput) data.firstName = firstNameInput.value.trim();
      if (lastNameInput) data.lastName = lastNameInput.value.trim();
      if (emailInput) data.email = emailInput.value.trim();
      if (phoneInput) {
        const phoneNumber = phoneInput.value.trim();
        // Combine country code with phone number
        data.phone = countryCode + phoneNumber;
      }
      data.language = language;
      
      // Get AO Leader - check multiple sources
      let aoLeaderValue = '';
      
      // Priority 1: Button dataset
      const button = submitForm.querySelector('button[data-slot="trigger"]') || 
                     submitForm.querySelector('button[aria-haspopup="listbox"]:not(.country-code-button)') ||
                     submitForm.querySelector('button#react-aria-\\:R25icv6jaH2\\:');
      if (button && button.dataset.selectedLeader) {
        aoLeaderValue = button.dataset.selectedLeader;
        console.log('âœ“ Got leader from button dataset:', aoLeaderValue);
      }
      
      // Priority 2: Value span
      if (!aoLeaderValue) {
        const valueSp = submitForm.querySelector('span[data-slot="value"]') ||
                        submitForm.querySelector('span#react-aria-\\:R25icv6jaH7\\:');
        if (valueSp && valueSp.textContent && 
            valueSp.textContent.trim() !== 'Choose one' && 
            valueSp.textContent.trim() !== '') {
          aoLeaderValue = valueSp.textContent.trim();
          console.log('âœ“ Got leader from valueSpan:', aoLeaderValue);
        }
      }
      
      // Priority 3: Global valueSpan
      if (!aoLeaderValue && valueSpan) {
        aoLeaderValue = valueSpan.textContent.trim();
        if (aoLeaderValue === 'Choose one' || aoLeaderValue === '') {
          aoLeaderValue = '';
        } else {
          console.log('âœ“ Got leader from global valueSpan:', aoLeaderValue);
        }
      }
      
      // Priority 4: Select element
      if (!aoLeaderValue) {
        let selectEl = submitForm.querySelector('select[name="select"]');
        if (!selectEl) {
          selectEl = submitForm.querySelector('[data-testid="hidden-select-container"] select');
        }
        if (selectEl && selectEl.value && selectEl.value.trim() !== '') {
          aoLeaderValue = selectEl.value.trim();
          console.log('âœ“ Got leader from selectElement:', aoLeaderValue);
        }
      }
      
      // Priority 5: Global selectElement
      if (!aoLeaderValue && selectElement && selectElement.value) {
        aoLeaderValue = selectElement.value.trim();
        if (aoLeaderValue) {
          console.log('âœ“ Got leader from global selectElement:', aoLeaderValue);
        }
      }
      
      data.ao_leader = aoLeaderValue;
      
      console.log('=== FORM DATA ===');
      console.log('firstName:', data.firstName);
      console.log('lastName:', data.lastName);
      console.log('email:', data.email);
      console.log('phone:', data.phone);
      console.log('language:', data.language);
      console.log('ao_leader:', data.ao_leader);
      
      // Validate
      if (!data.firstName || !data.lastName || !data.email || !data.phone || !data.ao_leader) {
        console.error('Validation failed:', {
          firstName: !!data.firstName,
          lastName: !!data.lastName,
          email: !!data.email,
          phone: !!data.phone,
          ao_leader: !!data.ao_leader
        });
        // Validation error - no alert popup
        return;
      }
      
      console.log('All fields valid, submitting...');
      
      try {
        const response = await fetch('/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
          console.log('Registration successful!');
          // Success - redirect without alert popup
          window.location.href = '/success.html';
        } else {
          console.error('Registration failed:', result.error);
          // Registration failed - no alert popup, error logged to console
        }
      } catch (error) {
        console.error('Error submitting form:', error);
        // Error occurred - no alert popup, error logged to console
      }
    });
  }
})();

</script>